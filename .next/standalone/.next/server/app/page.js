(()=>{var e={};e.id=931,e.ids=[931],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},3503:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var s=r(482),a=r(9108),n=r(2563),i=r.n(n),o=r(8300),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let d=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,1136)),"/root/todakugenv2/src/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,477)),"/root/todakugenv2/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9361,23)),"next/dist/client/components/not-found-error"]}],c=["/root/todakugenv2/src/app/page.tsx"],u="/page",x={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},8107:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2583,23)),Promise.resolve().then(r.t.bind(r,6840,23)),Promise.resolve().then(r.t.bind(r,8771,23)),Promise.resolve().then(r.t.bind(r,3225,23)),Promise.resolve().then(r.t.bind(r,9295,23)),Promise.resolve().then(r.t.bind(r,3982,23))},3249:(e,t,r)=>{Promise.resolve().then(r.bind(r,403))},5349:(e,t,r)=>{Promise.resolve().then(r.bind(r,8863))},8863:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var s=r(5344),a=r(3729),n=r(5094),i=r(6540),o=r(7361),l=r(8704),d=r(6506);function c(){let[e,t]=(0,a.useState)([]),[r,n]=(0,a.useState)(!0),[i,o]=(0,a.useState)(null),c=(0,l.e)();return((0,a.useEffect)(()=>{(async function(){try{let{data:e,error:r}=await c.from("stories").select("*").order("created_at",{ascending:!1}).limit(6);if(r)throw r;t(e||[])}catch(e){console.error("Error fetching stories:",e),o(e instanceof Error?e.message:"Failed to fetch stories")}finally{n(!1)}})()},[c]),r)?s.jsx("div",{className:"text-center text-muted-foreground",children:"Loading recent stories..."}):i?(0,s.jsxs)("div",{className:"text-center text-red-500",children:["Error loading stories: ",i]}):0===e.length?s.jsx("div",{className:"text-center text-muted-foreground",children:"No stories yet. Be the first to generate one!"}):s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>(0,s.jsxs)(d.default,{href:`/stories/${e.id}`,className:"block p-6 bg-card rounded-lg border hover:border-primary transition-colors",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:e.title}),s.jsx("div",{className:"text-sm text-muted-foreground mb-4",children:(0,s.jsxs)("div",{children:["Upvotes: ",e.upvotes]})}),s.jsx("div",{className:"text-sm line-clamp-3",children:e.content_jp})]},e.id))})}var u=r(8157),x=r(8428);function p(){let[e,t]=(0,a.useState)(""),[r,d]=(0,a.useState)(""),[p,h]=(0,a.useState)(""),[m,f]=(0,a.useState)(""),[g,v]=(0,a.useState)(!1),[b,y]=(0,a.useState)(null),j=(0,l.e)(),{preferences:w,isLoading:N,updatePreferences:k}=function(){let[e,t]=(0,a.useState)(null),[r,s]=(0,a.useState)(!0),[n,i]=(0,a.useState)(null),o=(0,l.e)();return(0,a.useEffect)(()=>{(async()=>{try{let{data:{session:e}}=await o.auth.getSession();if(!e){s(!1);return}let{data:r,error:a}=await o.from("profiles").select("*").eq("id",e.user.id).single();if(a)throw a;t(r)}catch(e){console.error("Error fetching preferences:",e),i(e instanceof Error?e.message:"Failed to fetch preferences")}finally{s(!1)}})()},[o]),{preferences:e,isLoading:r,error:n,updatePreferences:async e=>{try{let{data:{session:r}}=await o.auth.getSession();if(!r)throw Error("No active session");let{data:s,error:a}=await o.from("profiles").update(e).eq("id",r.user.id).select().single();if(a)throw a;t(s)}catch(e){throw console.error("Error updating preferences:",e),e}}}}(),S=(0,x.useRouter)();(0,a.useEffect)(()=>{w&&(console.log("Loading preferences:",w),t(w.wanikani_level?.toString()||"0"),d(w.genki_chapter?.toString()||"0"),h(w.tadoku_level?.toString()||"0"))},[w]);let _=async t=>{t.preventDefault(),v(!0),y(null);try{let{data:{session:t}}=await j.auth.getSession();if(!t)throw Error("Please sign in to generate stories");await k({wanikani_level:parseInt(e),genki_chapter:parseInt(r),tadoku_level:parseInt(p)});let s=await fetch("/api/stories/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({wanikaniLevel:parseInt(e),genkiChapter:parseInt(r),tadokuLevel:parseInt(p),topic:m})});if(!s.ok){let e=await s.json();throw Error(e.message||"Failed to generate story")}let a=await s.json();S.push(`/stories/${a.id}`)}catch(e){console.error("Error:",e),y(e instanceof Error?e.message:"Failed to generate story")}finally{v(!1)}};return N?s.jsx("main",{className:"flex-1",children:s.jsx("div",{className:"container mx-auto px-4 py-8 sm:py-12",children:s.jsx("div",{className:"text-center",children:"Loading preferences..."})})}):(0,s.jsxs)("main",{className:"flex-1",children:[(0,s.jsxs)("section",{className:"container mx-auto px-4 py-8 sm:py-12",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[s.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Tadoku Japanese Reader"}),s.jsx("p",{className:"text-xl text-muted-foreground",children:"Generate personalized Japanese stories based on your level and interests"})]}),(0,s.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(o._,{htmlFor:"wanikaniLevel",children:"Wanikani Level"}),(0,s.jsxs)(u.Ph,{value:e,onValueChange:t,children:[s.jsx(u.i4,{children:s.jsx(u.ki,{placeholder:"Select Wanikani level"})}),s.jsx(u.Bw,{className:"max-h-[300px] overflow-y-auto",children:[...Array(61)].map((e,t)=>(0,s.jsxs)(u.Ql,{value:t.toString(),children:["Level ",t]},t))})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(o._,{htmlFor:"genkiChapter",children:"Genki Chapter"}),(0,s.jsxs)(u.Ph,{value:r,onValueChange:d,children:[s.jsx(u.i4,{children:s.jsx(u.ki,{placeholder:"Select Genki chapter"})}),s.jsx(u.Bw,{className:"max-h-[300px] overflow-y-auto",children:[...Array(24)].map((e,t)=>(0,s.jsxs)(u.Ql,{value:t.toString(),children:["Chapter ",t]},t))})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(o._,{htmlFor:"tadokuLevel",children:"Tadoku Level"}),(0,s.jsxs)(u.Ph,{value:p,onValueChange:h,children:[s.jsx(u.i4,{children:s.jsx(u.ki,{placeholder:"Select Tadoku level"})}),s.jsx(u.Bw,{children:[...Array(6)].map((e,t)=>(0,s.jsxs)(u.Ql,{value:t.toString(),children:["Level ",t]},t))})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(o._,{htmlFor:"topic",children:"Topic"}),s.jsx(i.I,{id:"topic",value:m,onChange:e=>f(e.target.value),placeholder:"e.g., Daily Life",required:!0})]}),b&&s.jsx("div",{className:"text-red-500 text-sm",children:b}),s.jsx(n.z,{type:"submit",disabled:g,children:g?"Generating...":"Generate Story"})]})]}),(0,s.jsxs)("section",{className:"container mx-auto px-4 py-8 sm:py-12",children:[s.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Recent Stories"}),s.jsx(a.Suspense,{fallback:s.jsx("div",{className:"text-center",children:"Loading recent stories..."}),children:s.jsx(c,{})})]})]})}},403:(e,t,r)=>{"use strict";r.r(t),r.d(t,{NavBar:()=>c});var s=r(5344),a=r(8704),n=r(3729),i=r(5094),o=r(6506),l=r(8428),d=r(3746);let c=()=>{let[e,t]=(0,n.useState)(null),[r,c]=(0,n.useState)(!0),u=(0,l.useRouter)(),x=(0,a.e)(),p=(0,n.useCallback)(async()=>{try{c(!0),console.log("Starting sign in...");let{data:e,error:t}=await x.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`}});if(t)throw console.error("Sign in error:",t),t;console.log("Sign in response:",e),e?.url&&(window.location.href=e.url)}catch(e){console.error("Error during sign in:",e),c(!1)}},[x.auth]),h=(0,n.useCallback)(async()=>{try{c(!0),console.log("Starting sign out...");let{error:e}=await x.auth.signOut();if(e)throw e;t(null),u.refresh()}catch(e){console.error("Error signing out:",e)}finally{c(!1)}},[x.auth,u]);return((0,n.useEffect)(()=>{let e=!0;(async()=>{try{console.log("Initializing auth...");let{data:{session:r},error:s}=await x.auth.getSession();if(s){console.error("Error getting session:",s);return}console.log("Session:",r),e&&t(r?.user??null)}catch(e){console.error("Error getting session:",e)}finally{e&&c(!1)}})();let{data:{subscription:r}}=x.auth.onAuthStateChange((r,s)=>{console.log("Auth state changed:",r,s),e&&(t(s?.user??null),("SIGNED_IN"===r||"SIGNED_OUT"===r)&&u.refresh())});return()=>{e=!1,r.unsubscribe()}},[x.auth,u]),r)?s.jsx("nav",{className:"border-b",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between h-16 items-center",children:[s.jsx(o.default,{href:"/",className:"text-xl font-bold",children:"Tadoku Reader"}),s.jsx("div",{children:s.jsx(i.z,{disabled:!0,children:"Loading..."})})]})})}):s.jsx("nav",{className:"border-b",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between h-16 items-center",children:[s.jsx(o.default,{href:"/",className:"text-xl font-bold",children:"Tadoku Reader"}),s.jsx("div",{className:"flex items-center gap-4",children:e?(0,s.jsxs)(s.Fragment,{children:[s.jsx(o.default,{href:"/settings",className:"text-sm text-gray-500 hover:text-gray-700",children:s.jsx(d.Z,{className:"h-5 w-5"})}),s.jsx("span",{className:"text-sm text-gray-500",children:e.email}),s.jsx(i.z,{variant:"outline",onClick:h,disabled:r,children:r?"Signing out...":"Sign Out"})]}):s.jsx(i.z,{onClick:p,disabled:r,children:r?"Redirecting...":"Sign in with Google"})})]})})})}},5094:(e,t,r)=>{"use strict";r.d(t,{z:()=>d});var s=r(5344),a=r(3729),n=r(2751),i=r(9247),o=r(1453);let l=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef(({className:e,variant:t,size:r,asChild:a=!1,...i},d)=>{let c=a?n.g7:"button";return s.jsx(c,{className:(0,o.cn)(l({variant:t,size:r,className:e})),ref:d,...i})});d.displayName="Button"},6540:(e,t,r)=>{"use strict";r.d(t,{I:()=>i});var s=r(5344),a=r(3729),n=r(1453);let i=a.forwardRef(({className:e,type:t,...r},a)=>s.jsx("input",{type:t,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...r}));i.displayName="Input"},7361:(e,t,r)=>{"use strict";r.d(t,{_:()=>d});var s=r(5344),a=r(3729),n=r(4217),i=r(9247),o=r(1453);let l=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=a.forwardRef(({className:e,...t},r)=>s.jsx(n.f,{ref:r,className:(0,o.cn)(l(),e),...t}));d.displayName=n.f.displayName},8157:(e,t,r)=>{"use strict";r.d(t,{Bw:()=>x,Ph:()=>d,Ql:()=>p,i4:()=>u,ki:()=>c});var s=r(5344),a=r(3729),n=r(6453),i=r(5390),o=r(2312),l=r(1453);let d=n.fC;n.ZA;let c=n.B4,u=a.forwardRef(({className:e,children:t,...r},a)=>(0,s.jsxs)(n.xz,{ref:a,className:(0,l.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...r,children:[t,s.jsx(n.JO,{asChild:!0,children:s.jsx(i.Z,{className:"h-4 w-4 opacity-50"})})]}));u.displayName=n.xz.displayName;let x=a.forwardRef(({className:e,children:t,position:r="popper",...a},i)=>s.jsx(n.h_,{children:s.jsx(n.VY,{ref:i,className:(0,l.cn)("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...a,children:s.jsx(n.l_,{className:(0,l.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t})})}));x.displayName=n.VY.displayName,a.forwardRef(({className:e,...t},r)=>s.jsx(n.__,{ref:r,className:(0,l.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t})).displayName=n.__.displayName;let p=a.forwardRef(({className:e,children:t,...r},a)=>(0,s.jsxs)(n.ck,{ref:a,className:(0,l.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[s.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(n.wU,{children:s.jsx(o.Z,{className:"h-4 w-4"})})}),s.jsx(n.eT,{children:t})]}));p.displayName=n.ck.displayName,a.forwardRef(({className:e,...t},r)=>s.jsx(n.Z0,{ref:r,className:(0,l.cn)("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=n.Z0.displayName},8704:(e,t,r)=>{"use strict";r.d(t,{e:()=>n});var s=r(7435);let a=null,n=()=>(a||(a=(0,s.createClientComponentClient)()),a)},1453:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var s=r(6815),a=r(9377);function n(...e){return(0,a.m6)((0,s.W)(e))}},477:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x,metadata:()=>u});var s=r(5036),a=r(2195),n=r.n(a);r(5023);var i=r(6843);let o=(0,i.createProxy)(String.raw`/root/todakugenv2/src/components/nav-bar.tsx`),{__esModule:l,$$typeof:d}=o;o.default;let c=(0,i.createProxy)(String.raw`/root/todakugenv2/src/components/nav-bar.tsx#NavBar`),u={title:"Tadoku Japanese Reader",description:"Generate personalized Japanese graded readers based on your level and interests."};function x({children:e}){return s.jsx("html",{lang:"en",children:(0,s.jsxs)("body",{className:n().className,children:[s.jsx(c,{}),e]})})}},1136:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>i});let s=(0,r(6843).createProxy)(String.raw`/root/todakugenv2/src/app/page.tsx`),{__esModule:a,$$typeof:n}=s,i=s.default},5023:()=>{}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[225,606,150],()=>r(3503));module.exports=s})();