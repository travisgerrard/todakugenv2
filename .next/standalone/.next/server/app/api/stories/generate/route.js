"use strict";(()=>{var e={};e.id=607,e.ids=[607],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},1017:e=>{e.exports=require("path")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},1267:e=>{e.exports=require("worker_threads")},9796:e=>{e.exports=require("zlib")},7920:(e,t,r)=>{let n,o,s,i,a,l,u,c,h,d,f;r.r(t),r.d(t,{headerHooks:()=>oK,originalPathname:()=>oY,patchFetch:()=>oG,requestAsyncStorage:()=>oV,routeModule:()=>oH,serverHooks:()=>oX,staticGenerationAsyncStorage:()=>oJ,staticGenerationBailout:()=>oQ});var p,m,y,b,g,_,w,v,S,T,E,x,k,R,A,C,P,O,q,j,$,I,L,M,B,W,F,z,N,D,U,H,V,J,X,K,Q,Y,G,Z,ee,et,er,en,eo,es,ei,ea,el,eu,ec,eh,ed,ef,ep,em,ey,eb,eg,e_,ew,ev,eS,eT,eE,ex,ek,eR,eA,eC,eP,eO,eq,ej,e$,eI,eL,eM,eB={};r.r(eB),r.d(eB,{POST:()=>oU});var eW=r(5419),eF=r(9108),ez=r(9678),eN=r(7699),eD=r(7439),eU=r(8070);let eH="RFC3986",eV={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},eJ=(Object.prototype.hasOwnProperty,Array.isArray),eX=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function eK(e,t){if(eJ(e)){let r=[];for(let n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)}let eQ=Object.prototype.hasOwnProperty,eY={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},eG=Array.isArray,eZ=Array.prototype.push,e0=function(e,t){eZ.apply(e,eG(t)?t:[t])},e1=Date.prototype.toISOString,e2={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,r,n,o)=>{if(0===e.length)return e;let s=e;if("symbol"==typeof e?s=Symbol.prototype.toString.call(e):"string"!=typeof e&&(s=String(e)),"iso-8859-1"===r)return escape(s).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let i="";for(let e=0;e<s.length;e+=1024){let t=s.length>=1024?s.slice(e,e+1024):s,r=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);if(45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===o&&(40===n||41===n)){r[r.length]=t.charAt(e);continue}if(n<128){r[r.length]=eX[n];continue}if(n<2048){r[r.length]=eX[192|n>>6]+eX[128|63&n];continue}if(n<55296||n>=57344){r[r.length]=eX[224|n>>12]+eX[128|n>>6&63]+eX[128|63&n];continue}e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),r[r.length]=eX[240|n>>18]+eX[128|n>>12&63]+eX[128|n>>6&63]+eX[128|63&n]}i+=r.join("")}return i},encodeValuesOnly:!1,format:eH,formatter:eV[eH],indices:!1,serializeDate:e=>e1.call(e),skipNulls:!1,strictNullHandling:!1},e3={},e8="4.89.1",e6=!1;var e5=r(2781),e4=r(3685),e7=r(7310),e9=r(3122),te=r(5687),tt=r(9796);let tr=e5.Readable,tn=Symbol("buffer"),to=Symbol("type");class ts{constructor(){this[to]="";let e=arguments[0],t=arguments[1],r=[];if(e){let t=Number(e.length);for(let n=0;n<t;n++){let t;let o=e[n];(t=o instanceof Buffer?o:ArrayBuffer.isView(o)?Buffer.from(o.buffer,o.byteOffset,o.byteLength):o instanceof ArrayBuffer?Buffer.from(o):o instanceof ts?o[tn]:Buffer.from("string"==typeof o?o:String(o))).length,r.push(t)}}this[tn]=Buffer.concat(r);let n=t&&void 0!==t.type&&String(t.type).toLowerCase();n&&!/[^\u0020-\u007E]/.test(n)&&(this[to]=n)}get size(){return this[tn].length}get type(){return this[to]}text(){return Promise.resolve(this[tn].toString())}arrayBuffer(){let e=this[tn];return Promise.resolve(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}stream(){let e=new tr;return e._read=function(){},e.push(this[tn]),e.push(null),e}toString(){return"[object Blob]"}slice(){let e;let t=this.size,r=arguments[0],n=arguments[1];e=void 0===r?0:r<0?Math.max(t+r,0):Math.min(r,t);let o=Math.max((void 0===n?t:n<0?Math.max(t+n,0):Math.min(n,t))-e,0),s=this[tn].slice(e,e+o),i=new ts([],{type:arguments[2]});return i[tn]=s,i}}function ti(e,t,r){Error.call(this,e),this.message=e,this.type=t,r&&(this.code=this.errno=r.code),Error.captureStackTrace(this,this.constructor)}Object.defineProperties(ts.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(ts.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),ti.prototype=Object.create(Error.prototype),ti.prototype.constructor=ti,ti.prototype.name="FetchError";try{n=require("encoding").convert}catch(e){}let ta=Symbol("Body internals"),tl=e5.PassThrough;function tu(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.size,o=r.timeout;null==e?e=null:th(e)?e=Buffer.from(e.toString()):td(e)||Buffer.isBuffer(e)||("[object ArrayBuffer]"===Object.prototype.toString.call(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof e5||(e=Buffer.from(String(e)))),this[ta]={body:e,disturbed:!1,error:null},this.size=void 0===n?0:n,this.timeout=void 0===o?0:o,e instanceof e5&&e.on("error",function(e){let r="AbortError"===e.name?e:new ti(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e);t[ta].error=r})}function tc(){var e=this;if(this[ta].disturbed)return tu.Promise.reject(TypeError(`body used already for: ${this.url}`));if(this[ta].disturbed=!0,this[ta].error)return tu.Promise.reject(this[ta].error);let t=this.body;if(null===t)return tu.Promise.resolve(Buffer.alloc(0));if(td(t)&&(t=t.stream()),Buffer.isBuffer(t))return tu.Promise.resolve(t);if(!(t instanceof e5))return tu.Promise.resolve(Buffer.alloc(0));let r=[],n=0,o=!1;return new tu.Promise(function(s,i){let a;e.timeout&&(a=setTimeout(function(){o=!0,i(new ti(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))},e.timeout)),t.on("error",function(t){"AbortError"===t.name?(o=!0,i(t)):i(new ti(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))}),t.on("data",function(t){if(!o&&null!==t){if(e.size&&n+t.length>e.size){o=!0,i(new ti(`content size at ${e.url} over limit: ${e.size}`,"max-size"));return}n+=t.length,r.push(t)}}),t.on("end",function(){if(!o){clearTimeout(a);try{s(Buffer.concat(r,n))}catch(t){i(new ti(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}})})}function th(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function td(e){return"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function tf(e){let t,r;let n=e.body;if(e.bodyUsed)throw Error("cannot clone body after it is used");return n instanceof e5&&"function"!=typeof n.getBoundary&&(t=new tl,r=new tl,n.pipe(t),n.pipe(r),e[ta].body=t,n=r),n}function tp(e){if(null===e)return null;if("string"==typeof e)return"text/plain;charset=UTF-8";if(th(e))return"application/x-www-form-urlencoded;charset=UTF-8";if(td(e))return e.type||null;if(Buffer.isBuffer(e))return null;if("[object ArrayBuffer]"===Object.prototype.toString.call(e))return null;if(ArrayBuffer.isView(e))return null;else if("function"==typeof e.getBoundary)return`multipart/form-data;boundary=${e.getBoundary()}`;else if(e instanceof e5)return null;else return"text/plain;charset=UTF-8"}function tm(e){let t=e.body;return null===t?0:td(t)?t.size:Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}tu.prototype={get body(){return this[ta].body},get bodyUsed(){return this[ta].disturbed},arrayBuffer(){return tc.call(this).then(function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)})},blob(){let e=this.headers&&this.headers.get("content-type")||"";return tc.call(this).then(function(t){return Object.assign(new ts([],{type:e.toLowerCase()}),{[tn]:t})})},json(){var e=this;return tc.call(this).then(function(t){try{return JSON.parse(t.toString())}catch(t){return tu.Promise.reject(new ti(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}})},text(){return tc.call(this).then(function(e){return e.toString()})},buffer(){return tc.call(this)},textConverted(){var e=this;return tc.call(this).then(function(t){return function(e,t){let r,o;if("function"!=typeof n)throw Error("The package `encoding` must be installed to use the textConverted() function");let s=t.get("content-type"),i="utf-8";return s&&(r=/charset=([^;]*)/i.exec(s)),o=e.slice(0,1024).toString(),!r&&o&&(r=/<meta.+?charset=(['"])(.+?)\1/i.exec(o)),!r&&o&&(!(r=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(o))&&(r=/<meta[\s]+?content=(['"])(.+?)\1[\s]+?http-equiv=(['"])content-type\3/i.exec(o))&&r.pop(),r&&(r=/charset=(.*)/i.exec(r.pop()))),!r&&o&&(r=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(o)),r&&("gb2312"===(i=r.pop())||"gbk"===i)&&(i="gb18030"),n(e,"UTF-8",i).toString()}(t,e.headers)})}},Object.defineProperties(tu.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),tu.mixIn=function(e){for(let t of Object.getOwnPropertyNames(tu.prototype))if(!(t in e)){let r=Object.getOwnPropertyDescriptor(tu.prototype,t);Object.defineProperty(e,t,r)}},tu.Promise=global.Promise;let ty=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,tb=/[^\t\x20-\x7e\x80-\xff]/;function tg(e){if(e=`${e}`,ty.test(e)||""===e)throw TypeError(`${e} is not a legal HTTP header name`)}function t_(e){if(e=`${e}`,tb.test(e))throw TypeError(`${e} is not a legal HTTP header value`)}function tw(e,t){for(let r in t=t.toLowerCase(),e)if(r.toLowerCase()===t)return r}let tv=Symbol("map");class tS{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[tv]=Object.create(null),e instanceof tS){let t=e.raw();for(let e of Object.keys(t))for(let r of t[e])this.append(e,r);return}if(null==e);else if("object"==typeof e){let t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw TypeError("Header pairs must be iterable");let r=[];for(let t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw TypeError("Each header pair must be iterable");r.push(Array.from(t))}for(let e of r){if(2!==e.length)throw TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(let t of Object.keys(e)){let r=e[t];this.append(t,r)}}else throw TypeError("Provided initializer must be an object")}get(e){tg(e=`${e}`);let t=tw(this[tv],e);return void 0===t?null:this[tv][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=tT(this),n=0;for(;n<r.length;){var o=r[n];let s=o[0],i=o[1];e.call(t,i,s,this),r=tT(this),n++}}set(e,t){e=`${e}`,t=`${t}`,tg(e),t_(t);let r=tw(this[tv],e);this[tv][void 0!==r?r:e]=[t]}append(e,t){e=`${e}`,t=`${t}`,tg(e),t_(t);let r=tw(this[tv],e);void 0!==r?this[tv][r].push(t):this[tv][e]=[t]}has(e){return tg(e=`${e}`),void 0!==tw(this[tv],e)}delete(e){tg(e=`${e}`);let t=tw(this[tv],e);void 0!==t&&delete this[tv][t]}raw(){return this[tv]}keys(){return tx(this,"key")}values(){return tx(this,"value")}[Symbol.iterator](){return tx(this,"key+value")}}function tT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";return Object.keys(e[tv]).sort().map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[tv][t].join(", ")}:function(t){return[t.toLowerCase(),e[tv][t].join(", ")]})}tS.prototype.entries=tS.prototype[Symbol.iterator],Object.defineProperty(tS.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(tS.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});let tE=Symbol("internal");function tx(e,t){let r=Object.create(tk);return r[tE]={target:e,kind:t,index:0},r}let tk=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==tk)throw TypeError("Value of `this` is not a HeadersIterator");var e=this[tE];let t=e.target,r=e.kind,n=e.index,o=tT(t,r);return n>=o.length?{value:void 0,done:!0}:(this[tE].index=n+1,{value:o[n],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));Object.defineProperty(tk,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});let tR=Symbol("Response internals"),tA=e4.STATUS_CODES;class tC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};tu.call(this,e,t);let r=t.status||200,n=new tS(t.headers);if(null!=e&&!n.has("Content-Type")){let t=tp(e);t&&n.append("Content-Type",t)}this[tR]={url:t.url,status:r,statusText:t.statusText||tA[r],headers:n,counter:t.counter}}get url(){return this[tR].url||""}get status(){return this[tR].status}get ok(){return this[tR].status>=200&&this[tR].status<300}get redirected(){return this[tR].counter>0}get statusText(){return this[tR].statusText}get headers(){return this[tR].headers}clone(){return new tC(tf(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}tu.mixIn(tC.prototype),Object.defineProperties(tC.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(tC.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});let tP=Symbol("Request internals"),tO=e7.URL||e9.URL,tq=e7.parse,tj=e7.format;function t$(e){return/^[a-zA-Z][a-zA-Z\d+\-.]*:/.exec(e)&&(e=new tO(e).toString()),tq(e)}let tI="destroy"in e5.Readable.prototype;function tL(e){return"object"==typeof e&&"object"==typeof e[tP]}class tM{constructor(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};tL(e)?t=t$(e.url):(t=e&&e.href?t$(e.href):t$(`${e}`),e={});let n=r.method||e.method||"GET";if(n=n.toUpperCase(),(null!=r.body||tL(e)&&null!==e.body)&&("GET"===n||"HEAD"===n))throw TypeError("Request with GET/HEAD method cannot have body");let o=null!=r.body?r.body:tL(e)&&null!==e.body?tf(e):null;tu.call(this,o,{timeout:r.timeout||e.timeout||0,size:r.size||e.size||0});let s=new tS(r.headers||e.headers||{});if(null!=o&&!s.has("Content-Type")){let e=tp(o);e&&s.append("Content-Type",e)}let i=tL(e)?e.signal:null;if("signal"in r&&(i=r.signal),null!=i&&!function(e){let t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!!(t&&"AbortSignal"===t.constructor.name)}(i))throw TypeError("Expected signal to be an instanceof AbortSignal");this[tP]={method:n,redirect:r.redirect||e.redirect||"follow",headers:s,parsedURL:t,signal:i},this.follow=void 0!==r.follow?r.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==r.compress?r.compress:void 0===e.compress||e.compress,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent}get method(){return this[tP].method}get url(){return tj(this[tP].parsedURL)}get headers(){return this[tP].headers}get redirect(){return this[tP].redirect}get signal(){return this[tP].signal}clone(){return new tM(this)}}function tB(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}tu.mixIn(tM.prototype),Object.defineProperty(tM.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(tM.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),tB.prototype=Object.create(Error.prototype),tB.prototype.constructor=tB,tB.prototype.name="AbortError";let tW=e7.URL||e9.URL,tF=e5.PassThrough,tz=function(e,t){let r=new tW(t).hostname,n=new tW(e).hostname;return r===n||"."===r[r.length-n.length-1]&&r.endsWith(n)};function tN(e,t){if(!tN.Promise)throw Error("native promise missing, set fetch.Promise to your favorite alternative");return tu.Promise=tN.Promise,new tN.Promise(function(r,n){var o;let s,i;let a=new tM(e,t),l=function(e){let t=e[tP].parsedURL,r=new tS(e[tP].headers);if(r.has("Accept")||r.set("Accept","*/*"),!t.protocol||!t.hostname)throw TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(t.protocol))throw TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof e5.Readable&&!tI)throw Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let n=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(n="0"),null!=e.body){let t=tm(e);"number"==typeof t&&(n=String(t))}n&&r.set("Content-Length",n),r.has("User-Agent")||r.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip,deflate");let o=e.agent;return"function"==typeof o&&(o=o(t)),Object.assign({},t,{method:e.method,headers:function(e){let t=Object.assign({__proto__:null},e[tv]),r=tw(e[tv],"Host");return void 0!==r&&(t[r]=t[r][0]),t}(r),agent:o})}(a),u=("https:"===l.protocol?te:e4).request,c=a.signal,h=null,d=function(){let e=new tB("The user aborted a request.");n(e),a.body&&a.body instanceof e5.Readable&&tD(a.body,e),h&&h.body&&h.body.emit("error",e)};if(c&&c.aborted){d();return}let f=function(){d(),m()},p=u(l);function m(){p.abort(),c&&c.removeEventListener("abort",f),clearTimeout(s)}c&&c.addEventListener("abort",f),a.timeout&&p.once("socket",function(e){s=setTimeout(function(){n(new ti(`network timeout at: ${a.url}`,"request-timeout")),m()},a.timeout)}),p.on("error",function(e){n(new ti(`request to ${a.url} failed, reason: ${e.message}`,"system",e)),h&&h.body&&tD(h.body,e),m()}),o=function(e){(!c||!c.aborted)&&h&&h.body&&tD(h.body,e)},p.on("socket",function(e){i=e}),p.on("response",function(e){let t=e.headers;"chunked"!==t["transfer-encoding"]||t["content-length"]||e.once("close",function(e){if(i&&i.listenerCount("data")>0&&!e){let e=Error("Premature close");e.code="ERR_STREAM_PREMATURE_CLOSE",o(e)}})}),14>parseInt(process.version.substring(1))&&p.on("socket",function(e){e.addListener("close",function(t){let r=e.listenerCount("data")>0;if(h&&r&&!t&&!(c&&c.aborted)){let e=Error("Premature close");e.code="ERR_STREAM_PREMATURE_CLOSE",h.body.emit("error",e)}})}),p.on("response",function(e){clearTimeout(s);let t=function(e){let t=new tS;for(let r of Object.keys(e))if(!ty.test(r)){if(Array.isArray(e[r]))for(let n of e[r])tb.test(n)||(void 0===t[tv][r]?t[tv][r]=[n]:t[tv][r].push(n));else tb.test(e[r])||(t[tv][r]=[e[r]])}return t}(e.headers);if(tN.isRedirect(e.statusCode)){let s=t.get("Location"),i=null;try{i=null===s?null:new tW(s,a.url).toString()}catch(e){if("manual"!==a.redirect){n(new ti(`uri requested responds with an invalid redirect URL: ${s}`,"invalid-redirect")),m();return}}switch(a.redirect){case"error":n(new ti(`uri requested responds with a redirect, redirect mode is set to error: ${a.url}`,"no-redirect")),m();return;case"manual":if(null!==i)try{t.set("Location",i)}catch(e){n(e)}break;case"follow":var o;if(null===i)break;if(a.counter>=a.follow){n(new ti(`maximum redirect reached at: ${a.url}`,"max-redirect")),m();return}let l={headers:new tS(a.headers),follow:a.follow,counter:a.counter+1,agent:a.agent,compress:a.compress,method:a.method,body:a.body,signal:a.signal,timeout:a.timeout,size:a.size};if(!tz(a.url,i)||(o=a.url,new tW(i).protocol!==new tW(o).protocol))for(let e of["authorization","www-authenticate","cookie","cookie2"])l.headers.delete(e);if(303!==e.statusCode&&a.body&&null===tm(a)){n(new ti("Cannot follow redirect with body being a readable stream","unsupported-redirect")),m();return}(303===e.statusCode||(301===e.statusCode||302===e.statusCode)&&"POST"===a.method)&&(l.method="GET",l.body=void 0,l.headers.delete("content-length")),r(tN(new tM(i,l))),m();return}}e.once("end",function(){c&&c.removeEventListener("abort",f)});let i=e.pipe(new tF),l={url:a.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:a.size,timeout:a.timeout,counter:a.counter},u=t.get("Content-Encoding");if(!a.compress||"HEAD"===a.method||null===u||204===e.statusCode||304===e.statusCode){r(h=new tC(i,l));return}let d={flush:tt.Z_SYNC_FLUSH,finishFlush:tt.Z_SYNC_FLUSH};if("gzip"==u||"x-gzip"==u){r(h=new tC(i=i.pipe(tt.createGunzip(d)),l));return}if("deflate"==u||"x-deflate"==u){let t=e.pipe(new tF);t.once("data",function(e){r(h=new tC(i=(15&e[0])==8?i.pipe(tt.createInflate()):i.pipe(tt.createInflateRaw()),l))}),t.on("end",function(){h||r(h=new tC(i,l))});return}if("br"==u&&"function"==typeof tt.createBrotliDecompress){r(h=new tC(i=i.pipe(tt.createBrotliDecompress()),l));return}r(h=new tC(i,l))}),function(e,t){let r=t.body;null===r?e.end():td(r)?r.stream().pipe(e):Buffer.isBuffer(r)?(e.write(r),e.end()):r.pipe(e)}(p,a)})}function tD(e,t){e.destroy?e.destroy(t):(e.emit("error",t),e.end())}tN.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},tN.Promise=global.Promise;var tU=r(3837),tH=r(2169),tV=r(5620),tJ=r(4512);let tX=e=>e instanceof tJ.t;var tK=r(8692);let tQ=(0,tU.deprecate)(()=>{},'Constructor "entries" argument is not spec-compliant and will be removed in next major release.');var tY=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class tG{constructor(e){p.add(this),m.set(this,new Map),e&&(tQ(),e.forEach(({name:e,value:t,fileName:r})=>this.append(e,t,r)))}static[(m=new WeakMap,p=new WeakSet,Symbol.hasInstance)](e){return!!(e&&(0,tK.m)(e.constructor)&&"FormData"===e[Symbol.toStringTag]&&(0,tK.m)(e.append)&&(0,tK.m)(e.set)&&(0,tK.m)(e.get)&&(0,tK.m)(e.getAll)&&(0,tK.m)(e.has)&&(0,tK.m)(e.delete)&&(0,tK.m)(e.entries)&&(0,tK.m)(e.values)&&(0,tK.m)(e.keys)&&(0,tK.m)(e[Symbol.iterator])&&(0,tK.m)(e.forEach))}append(e,t,r){tY(this,p,"m",y).call(this,{name:e,fileName:r,append:!0,rawValue:t,argsLength:arguments.length})}set(e,t,r){tY(this,p,"m",y).call(this,{name:e,fileName:r,append:!1,rawValue:t,argsLength:arguments.length})}get(e){let t=tY(this,m,"f").get(String(e));return t?t[0]:null}getAll(e){let t=tY(this,m,"f").get(String(e));return t?t.slice():[]}has(e){return tY(this,m,"f").has(String(e))}delete(e){tY(this,m,"f").delete(String(e))}*keys(){for(let e of tY(this,m,"f").keys())yield e}*entries(){for(let e of this.keys())for(let t of this.getAll(e))yield[e,t]}*values(){for(let[,e]of this)yield e}[(y=function({name:e,rawValue:t,append:r,fileName:n,argsLength:o}){let s;let i=r?"append":"set";if(o<2)throw TypeError(`Failed to execute '${i}' on 'FormData': 2 arguments required, but only ${o} present.`);if(e=String(e),(0,tV.z)(t))s=void 0===n?t:new tH.$([t],n,{type:t.type,lastModified:t.lastModified});else if(tX(t))s=new tH.$([t],void 0===n?"blob":n,{type:t.type});else if(n)throw TypeError(`Failed to execute '${i}' on 'FormData': parameter 2 is not of type 'Blob'.`);else s=String(t);let a=tY(this,m,"f").get(e);if(!a||!r)return void tY(this,m,"f").set(e,[s]);a.push(s)},Symbol.iterator)](){return this.entries()}forEach(e,t){for(let[r,n]of this)e.call(t,n,r,this)}get[Symbol.toStringTag](){return"FormData"}[tU.inspect.custom](){return this[Symbol.toStringTag]}}var tZ=r(5685),t0=r(3843);let t1=require("node:fs"),t2="abcdefghijklmnopqrstuvwxyz0123456789",t3=function(){let e=16,t="";for(;e--;)t+=t2[Math.random()*t2.length<<0];return t},t8=e=>Object.prototype.toString.call(e).slice(8,-1).toLowerCase(),t6=function(e){if("object"!==t8(e))return!1;let t=Object.getPrototypeOf(e);return null==t||(t.constructor&&t.constructor.toString())===Object.toString()},t5=e=>String(e).replace(/\r|\n/g,(e,t,r)=>"\r"===e&&"\n"!==r[t+1]||"\n"===e&&"\r"!==r[t-1]?"\r\n":e),t4=e=>String(e).replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/"/g,"%22"),t7=e=>"function"==typeof e,t9=e=>!!(e&&"object"==typeof e&&t7(e.constructor)&&"File"===e[Symbol.toStringTag]&&t7(e.stream)&&null!=e.name&&null!=e.size&&null!=e.lastModified),re=e=>!!(e&&t7(e.constructor)&&"FormData"===e[Symbol.toStringTag]&&t7(e.append)&&t7(e.getAll)&&t7(e.entries)&&t7(e[Symbol.iterator]));var rt=function(e,t,r,n,o){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!o)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r},rr=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};let rn={enableAdditionalHeaders:!1};class ro{constructor(e,t,r){let n;if(b.add(this),g.set(this,"\r\n"),_.set(this,void 0),w.set(this,void 0),v.set(this,"-".repeat(2)),S.set(this,new TextEncoder),T.set(this,void 0),E.set(this,void 0),x.set(this,void 0),!re(e))throw TypeError("Expected first argument to be a FormData instance.");if(t6(t)?r=t:n=t,n||(n=t3()),"string"!=typeof n)throw TypeError("Expected boundary argument to be a string.");if(r&&!t6(r))throw TypeError("Expected options argument to be an object.");rt(this,E,e,"f"),rt(this,x,{...rn,...r},"f"),rt(this,_,rr(this,S,"f").encode(rr(this,g,"f")),"f"),rt(this,w,rr(this,_,"f").byteLength,"f"),this.boundary=`form-data-boundary-${n}`,this.contentType=`multipart/form-data; boundary=${this.boundary}`,rt(this,T,rr(this,S,"f").encode(`${rr(this,v,"f")}${this.boundary}${rr(this,v,"f")}${rr(this,g,"f").repeat(2)}`),"f"),this.contentLength=String(this.getContentLength()),this.headers=Object.freeze({"Content-Type":this.contentType,"Content-Length":this.contentLength}),Object.defineProperties(this,{boundary:{writable:!1,configurable:!1},contentType:{writable:!1,configurable:!1},contentLength:{writable:!1,configurable:!1},headers:{writable:!1,configurable:!1}})}getContentLength(){let e=0;for(let[t,r]of rr(this,E,"f")){let n=t9(r)?r:rr(this,S,"f").encode(t5(r));e+=rr(this,b,"m",k).call(this,t,n).byteLength+(t9(n)?n.size:n.byteLength)+rr(this,w,"f")}return e+rr(this,T,"f").byteLength}*values(){for(let[e,t]of rr(this,E,"f").entries()){let r=t9(t)?t:rr(this,S,"f").encode(t5(t));yield rr(this,b,"m",k).call(this,e,r),yield r,yield rr(this,_,"f")}yield rr(this,T,"f")}async *encode(){for(let e of this.values())t9(e)?yield*e.stream():yield e}[(g=new WeakMap,_=new WeakMap,w=new WeakMap,v=new WeakMap,S=new WeakMap,T=new WeakMap,E=new WeakMap,x=new WeakMap,b=new WeakSet,k=function(e,t){let r="";return r+=`${rr(this,v,"f")}${this.boundary}${rr(this,g,"f")}Content-Disposition: form-data; name="${t4(e)}"`,t9(t)&&(r+=`; filename="${t4(t.name)}"${rr(this,g,"f")}Content-Type: ${t.type||"application/octet-stream"}`),!0===rr(this,x,"f").enableAdditionalHeaders&&(r+=`${rr(this,g,"f")}Content-Length: ${t9(t)?t.size:t.byteLength}`),rr(this,S,"f").encode(`${r}${rr(this,g,"f").repeat(2)}`)},Symbol.iterator)](){return this.values()}[Symbol.asyncIterator](){return this.encode()}}let rs=require("node:stream");class ri{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}let ra=require("node:stream/web"),rl=!1;async function ru(e,...t){let{fileFromPath:n}=await r.e(958).then(r.bind(r,1958));return rl||(console.warn(`fileFromPath is deprecated; use fs.createReadStream(${JSON.stringify(e)}) instead`),rl=!0),await n(e,...t)}let rc=new tZ({keepAlive:!0,timeout:3e5}),rh=new tZ.HttpsAgent({keepAlive:!0,timeout:3e5});async function rd(e,t){let r=new ro(e),n=new ri(rs.Readable.from(r)),o={...t.headers,...r.headers,"Content-Length":r.contentLength};return{...t,body:n,headers:o}}s||function(e,t={auto:!1}){if(e6)throw Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(s)throw Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${s}'\``);e6=t.auto,s=e.kind,i=e.fetch,e.Request,e.Response,e.Headers,a=e.FormData,e.Blob,l=e.File,u=e.ReadableStream,c=e.getMultipartRequestOptions,h=e.getDefaultAgent,d=e.fileFromPath,f=e.isFsReadStream}(("undefined"==typeof AbortController&&(globalThis.AbortController=t0.AbortController),{kind:"node",fetch:tN,Request:tM,Response:tC,Headers:tS,FormData:tG,Blob:tJ.t,File:tH.$,ReadableStream:ra.ReadableStream,getMultipartRequestOptions:rd,getDefaultAgent:e=>e.startsWith("https")?rh:rc,fileFromPath:ru,isFsReadStream:e=>e instanceof t1.ReadStream}),{auto:!0});class rf extends Error{}class rp extends rf{constructor(e,t,r,n){super(`${rp.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.request_id=n?.["x-request-id"],this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,r){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){if(!e||!n)return new ry({message:r,cause:ns(t)});let o=t?.error;return 400===e?new rg(e,o,r,n):401===e?new r_(e,o,r,n):403===e?new rw(e,o,r,n):404===e?new rv(e,o,r,n):409===e?new rS(e,o,r,n):422===e?new rT(e,o,r,n):429===e?new rE(e,o,r,n):e>=500?new rx(e,o,r,n):new rp(e,o,r,n)}}class rm extends rp{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class ry extends rp{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class rb extends ry{constructor({message:e}={}){super({message:e??"Request timed out."})}}class rg extends rp{}class r_ extends rp{}class rw extends rp{}class rv extends rp{}class rS extends rp{}class rT extends rp{}class rE extends rp{}class rx extends rp{}class rk extends rf{constructor(){super("Could not parse response content as the length limit was reached")}}class rR extends rf{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var rA=function(e,t,r,n,o){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!o)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r},rC=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class rP{constructor(){R.set(this,void 0),this.buffer=new Uint8Array,rA(this,R,null,"f")}decode(e){let t;if(null==e)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?new TextEncoder().encode(e):e,n=new Uint8Array(this.buffer.length+r.length);n.set(this.buffer),n.set(r,this.buffer.length),this.buffer=n;let o=[];for(;null!=(t=function(e,t){for(let r=t??0;r<e.length;r++){if(10===e[r])return{preceding:r,index:r+1,carriage:!1};if(13===e[r])return{preceding:r,index:r+1,carriage:!0}}return null}(this.buffer,rC(this,R,"f")));){if(t.carriage&&null==rC(this,R,"f")){rA(this,R,t.index,"f");continue}if(null!=rC(this,R,"f")&&(t.index!==rC(this,R,"f")+1||t.carriage)){o.push(this.decodeText(this.buffer.slice(0,rC(this,R,"f")-1))),this.buffer=this.buffer.slice(rC(this,R,"f")),rA(this,R,null,"f");continue}let e=null!==rC(this,R,"f")?t.preceding-1:t.preceding,r=this.decodeText(this.buffer.slice(0,e));o.push(r),this.buffer=this.buffer.slice(t.index),rA(this,R,null,"f")}return o}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new rf(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new rf(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new rf("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode("\n"):[]}}function rO(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}R=new WeakMap,rP.NEWLINE_CHARS=new Set(["\n","\r"]),rP.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class rq{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;return new rq(async function*(){if(r)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let n=!1;try{for await(let r of rj(e,t))if(!n){if(r.data.startsWith("[DONE]")){n=!0;continue}if(null===r.event||r.event.startsWith("response.")){let e;try{e=JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if(e&&e.error)throw new rp(void 0,e.error,void 0,void 0);yield e}else{let e;try{e=JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if("error"==r.event)throw new rp(void 0,e.error,e.message,void 0);yield{event:r.event,data:e}}}n=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{n||t.abort()}},t)}static fromReadableStream(e,t){let r=!1;async function*n(){let t=new rP;for await(let r of rO(e))for(let e of t.decode(r))yield e;for(let e of t.flush())yield e}return new rq(async function*(){if(r)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{e||t.abort()}},t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=r.next();e.push(n),t.push(n)}return n.shift()}});return[new rq(()=>n(e),this.controller),new rq(()=>n(t),this.controller)]}toReadableStream(){let e;let t=this,r=new TextEncoder;return new u({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:n,done:o}=await e.next();if(o)return t.close();let s=r.encode(JSON.stringify(n)+"\n");t.enqueue(s)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*rj(e,t){if(!e.body)throw t.abort(),new rf("Attempted to iterate over a response with no body");let r=new rI,n=new rP;for await(let t of r$(rO(e.body)))for(let e of n.decode(t)){let t=r.decode(e);t&&(yield t)}for(let e of n.flush()){let t=r.decode(e);t&&(yield t)}}async function*r$(e){let t=new Uint8Array;for await(let r of e){let e;if(null==r)continue;let n=r instanceof ArrayBuffer?new Uint8Array(r):"string"==typeof r?new TextEncoder().encode(r):r,o=new Uint8Array(t.length+n.length);for(o.set(t),o.set(n,t.length),t=o;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class rI{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=function(e,t){let r=e.indexOf(t);return -1!==r?[e.substring(0,r),t,e.substring(r+t.length)]:[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}let rL=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,rM=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&rB(e),rB=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,rW=e=>rM(e)||rL(e)||f(e);async function rF(e,t,r){var n;if(rM(e=await e))return e;if(rL(e)){let n=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");let o=rB(n)?[await n.arrayBuffer()]:[n];return new l(o,t,r)}let o=await rz(e);if(t||(t=(rN((n=e).name)||rN(n.filename)||rN(n.path)?.split(/[\\/]/).pop())??"unknown_file"),!r?.type){let e=o[0]?.type;"string"==typeof e&&(r={...r,type:e})}return new l(o,t,r)}async function rz(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(rB(e))t.push(await e.arrayBuffer());else if(rD(e))for await(let r of e)t.push(r);else throw Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){let t=Object.getOwnPropertyNames(e);return`[${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`);return t}let rN=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,rD=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],rU=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],rH=async e=>{let t=await rV(e.body);return c(t,e)},rV=async e=>{let t=new a;return await Promise.all(Object.entries(e||{}).map(([e,r])=>rX(t,e,r))),t},rJ=e=>{if(rW(e))return!0;if(Array.isArray(e))return e.some(rJ);if(e&&"object"==typeof e){for(let t in e)if(rJ(e[t]))return!0}return!1},rX=async(e,t,r)=>{if(void 0!==r){if(null==r)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)e.append(t,String(r));else if(rW(r)){let n=await rF(r);e.append(t,n)}else if(Array.isArray(r))await Promise.all(r.map(r=>rX(e,t+"[]",r)));else if("object"==typeof r)await Promise.all(Object.entries(r).map(([r,n])=>rX(e,`${t}[${r}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}};var rK=function(e,t,r,n,o){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!o)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r},rQ=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};async function rY(e){let{response:t}=e;if(e.options.stream)return(nh("response",t.status,t.url,t.headers,t.body),e.options.__streamClass)?e.options.__streamClass.fromSSEResponse(t,e.controller):rq.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;let r=t.headers.get("content-type"),n=r?.split(";")[0]?.trim();if(n?.includes("application/json")||n?.endsWith("+json")){let e=await t.json();return nh("response",t.status,t.url,t.headers,e),rG(e,t)}let o=await t.text();return nh("response",t.status,t.url,t.headers,o),o}function rG(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class rZ extends Promise{constructor(e,t=rY){super(e=>{e(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new rZ(this.responsePromise,async t=>rG(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class r0{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:n,fetch:o}){this.baseURL=e,this.maxRetries=no("maxRetries",t),this.timeout=no("timeout",r),this.httpAgent=n,this.fetch=o??i}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...r9(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${nd()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async r=>{let n=r&&rB(r?.body)?new DataView(await r.body.arrayBuffer()):r?.body instanceof DataView?r.body:r?.body instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r?.body)?new DataView(r.body.buffer):r?.body;return{method:e,path:t,...r,body:n}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder)return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){let{method:r,path:n,query:o,headers:s={}}=e={...e},i=ArrayBuffer.isView(e.body)||e.__binaryRequest&&"string"==typeof e.body?e.body:rU(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,a=this.calculateContentLength(i),l=this.buildURL(n,o);"timeout"in e&&no("timeout",e.timeout),e.timeout=e.timeout??this.timeout;let u=e.httpAgent??this.httpAgent??h(l),c=e.timeout+1e3;"number"==typeof u?.options?.timeout&&c>(u.options.timeout??0)&&(u.options.timeout=c),this.idempotencyHeader&&"get"!==r&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey);let d=this.buildHeaders({options:e,headers:s,contentLength:a,retryCount:t});return{req:{method:r,...i&&{body:i},headers:d,...u&&{agent:u},signal:e.signal??null},url:l,timeout:e.timeout}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:n}){let o={};r&&(o["content-length"]=r);let i=this.defaultHeaders(e);return nu(o,i),nu(o,t),rU(e.body)&&"node"!==s&&delete o["content-type"],void 0===nm(i,"x-stainless-retry-count")&&void 0===nm(t,"x-stainless-retry-count")&&(o["x-stainless-retry-count"]=String(n)),void 0===nm(i,"x-stainless-timeout")&&void 0===nm(t,"x-stainless-timeout")&&e.timeout&&(o["x-stainless-timeout"]=String(e.timeout)),this.validateHeaders(o,t),o}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(e=>[...e])):{...e}:{}}makeStatusError(e,t,r,n){return rp.generate(e,t,r,n)}request(e,t=null){return new rZ(this.makeRequest(e,t))}async makeRequest(e,t){let r=await e,n=r.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(r);let{req:o,url:s,timeout:i}=this.buildRequest(r,{retryCount:n-t});if(await this.prepareRequest(o,{url:s,options:r}),nh("request",s,r,o.headers),r.signal?.aborted)throw new rm;let a=new AbortController,l=await this.fetchWithTimeout(s,o,i,a).catch(ns);if(l instanceof Error){if(r.signal?.aborted)throw new rm;if(t)return this.retryRequest(r,t);if("AbortError"===l.name)throw new rb;throw new ry({cause:l})}let u=r3(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){let e=`retrying, ${t} attempts remaining`;return nh(`response (error; ${e})`,l.status,s,u),this.retryRequest(r,t,u)}let e=await l.text().catch(e=>ns(e).message),n=ne(e),o=n?void 0:e,i=t?"(error; no more retries left)":"(error; not retryable)";throw nh(`response (error; ${i})`,l.status,s,u,o),this.makeStatusError(l.status,n,o,u)}return{response:l,options:r,controller:a}}requestAPIList(e,t){return new r2(this,this.makeRequest(t,null),e)}buildURL(e,t){let r=new URL(nr(e)?e:this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return na(n)||(t={...n,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new rf(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,n){let{signal:o,...s}=t||{};o&&o.addEventListener("abort",()=>n.abort());let i=setTimeout(()=>n.abort(),r),a={signal:n.signal,...s};return a.method&&(a.method=a.method.toUpperCase()),this.fetch.call(void 0,e,a).finally(()=>{clearTimeout(i)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,r){let n;let o=r?.["retry-after-ms"];if(o){let e=parseFloat(o);Number.isNaN(e)||(n=e)}let s=r?.["retry-after"];if(s&&!n){let e=parseFloat(s);n=Number.isNaN(e)?Date.parse(s)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let r=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,r)}return await nn(n),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${e8}`}}class r1{constructor(e,t,r,n){A.set(this,void 0),rK(this,A,e,"f"),this.options=n,this.response=t,this.body=r}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new rf("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){for(let[r,n]of[...Object.entries(t.query||{}),...e.url.searchParams.entries()])e.url.searchParams.set(r,n);t.query=void 0,t.path=e.url.toString()}return await rQ(this,A,"f").requestAPIList(this.constructor,t)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(A=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class r2 extends rZ{constructor(e,t,r){super(t,async t=>new r(e,t.response,await rY(t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}let r3=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),r8={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},r6=e=>"object"==typeof e&&null!==e&&!na(e)&&Object.keys(e).every(e=>nl(r8,e)),r5=()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e8,"X-Stainless-OS":r7(Deno.build.os),"X-Stainless-Arch":r4(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e8,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e8,"X-Stainless-OS":r7(process.platform),"X-Stainless-Arch":r4(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let e=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let r=t.exec(navigator.userAgent);if(r){let t=r[1]||0,n=r[2]||0,o=r[3]||0;return{browser:e,version:`${t}.${n}.${o}`}}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e8,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e8,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},r4=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",r7=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",r9=()=>o??(o=r5()),ne=e=>{try{return JSON.parse(e)}catch(e){return}},nt=/^[a-z][a-z0-9+.-]*:/i,nr=e=>nt.test(e),nn=e=>new Promise(t=>setTimeout(t,e)),no=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new rf(`${e} must be an integer`);if(t<0)throw new rf(`${e} must be a positive integer`);return t},ns=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return Error(JSON.stringify(e))}catch{}return Error(e)},ni=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function na(e){if(!e)return!0;for(let t in e)return!1;return!0}function nl(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function nu(e,t){for(let r in t){if(!nl(t,r))continue;let n=r.toLowerCase();if(!n)continue;let o=t[r];null===o?delete e[n]:void 0!==o&&(e[n]=o)}}let nc=new Set(["authorization","api-key"]);function nh(e,...t){"undefined"!=typeof process&&process?.env?.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${e}`,...t.map(e=>{if(!e)return e;if(e.headers){let t={...e,headers:{...e.headers}};for(let r in e.headers)nc.has(r.toLowerCase())&&(t.headers[r]="REDACTED");return t}let t=null;for(let r in e)nc.has(r.toLowerCase())&&(t??(t={...e}),t[r]="REDACTED");return t??e}))}let nd=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),nf=()=>!1,np=e=>"function"==typeof e?.get,nm=(e,t)=>{let r=t.toLowerCase();if(np(e)){let n=t[0]?.toUpperCase()+t.substring(1).replace(/([^\w])(\w)/g,(e,t,r)=>t+r.toUpperCase());for(let o of[t,r,t.toUpperCase(),n]){let t=e.get(o);if(t)return t}}for(let[n,o]of Object.entries(e))if(n.toLowerCase()===r){if(Array.isArray(o)){if(o.length<=1)return o[0];return console.warn(`Received ${o.length} entries for the ${t} header, using the first entry.`),o[0]}return o}};function ny(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class nb{constructor(e){this._client=e}}class ng extends nb{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class n_ extends nb{list(e,t={},r){return r6(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,nE,{query:t,...r})}}class nw extends r1{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class nv extends r1{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){let e=this.getPaginatedItems();if(!e.length)return null;let t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class nS extends nb{constructor(){super(...arguments),this.messages=new n_(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return r6(e)?this.list({},e):this._client.getAPIList("/chat/completions",nT,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}}class nT extends nv{}class nE extends nv{}nS.ChatCompletionsPage=nT,nS.Messages=n_;class nx extends nb{constructor(){super(...arguments),this.completions=new nS(this._client)}}nx.Completions=nS,nx.ChatCompletionsPage=nT;class nk extends nb{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class nR extends nb{create(e,t){return this._client.post("/files",rH({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return r6(e)?this.list({},e):this._client.getAPIList("/files",nA,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=18e5}={}){let n=new Set(["processed","error","deleted"]),o=Date.now(),s=await this.retrieve(e);for(;!s.status||!n.has(s.status);)if(await nn(t),s=await this.retrieve(e),Date.now()-o>r)throw new rb({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return s}}class nA extends nv{}nR.FileObjectsPage=nA;class nC extends nb{createVariation(e,t){return this._client.post("/images/variations",rH({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",rH({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class nP extends nb{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}}class nO extends nb{create(e,t){return this._client.post("/audio/transcriptions",rH({body:e,...t,__metadata:{model:e.model}}))}}class nq extends nb{create(e,t){return this._client.post("/audio/translations",rH({body:e,...t,__metadata:{model:e.model}}))}}class nj extends nb{constructor(){super(...arguments),this.transcriptions=new nO(this._client),this.translations=new nq(this._client),this.speech=new nP(this._client)}}nj.Transcriptions=nO,nj.Translations=nq,nj.Speech=nP;class n$ extends nb{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class nI extends nb{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",nL,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class nL extends nw{}nI.ModelsPage=nL;class nM extends nb{list(e,t={},r){return r6(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,nB,{query:t,...r})}}class nB extends nv{}nM.FineTuningJobCheckpointsPage=nB;class nW extends nb{constructor(){super(...arguments),this.checkpoints=new nM(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return r6(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",nF,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return r6(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,nz,{query:t,...r})}}class nF extends nv{}class nz extends nv{}nW.FineTuningJobsPage=nF,nW.FineTuningJobEventsPage=nz,nW.Checkpoints=nM,nW.FineTuningJobCheckpointsPage=nB;class nN extends nb{constructor(){super(...arguments),this.jobs=new nW(this._client)}}nN.Jobs=nW,nN.FineTuningJobsPage=nF,nN.FineTuningJobEventsPage=nz;let nD=async e=>{let t=await Promise.allSettled(e),r=t.filter(e=>"rejected"===e.status);if(r.length){for(let e of r)console.error(e.reason);throw Error(`${r.length} promise(s) failed - see the above errors`)}let n=[];for(let e of t)"fulfilled"===e.status&&n.push(e.value);return n};class nU extends nb{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,n){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},r){return r6(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,nH,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(e,n.id,r)}async poll(e,t,r){let n={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let o=await this.retrieve(e,t,{...r,headers:n}).withResponse(),s=o.data;switch(s.status){case"in_progress":let i=5e3;if(r?.pollIntervalMs)i=r.pollIntervalMs;else{let e=o.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await nn(i);break;case"failed":case"completed":return s}}}async upload(e,t,r){let n=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:n.id},r)}async uploadAndPoll(e,t,r){let n=await this.upload(e,t,r);return await this.poll(e,n.id,r)}content(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,nV,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class nH extends nv{}class nV extends nw{}nU.VectorStoreFilesPage=nH,nU.FileContentResponsesPage=nV;class nJ extends nb{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let n=await this.create(e,t);return await this.poll(e,n.id,r)}listFiles(e,t,r={},n){return r6(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,nH,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async poll(e,t,r){let n={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:o,response:s}=await this.retrieve(e,t,{...r,headers:n}).withResponse();switch(o.status){case"in_progress":let i=5e3;if(r?.pollIntervalMs)i=r.pollIntervalMs;else{let e=s.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await nn(i);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},n){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let o=Math.min(n?.maxConcurrency??5,t.length),s=this._client,i=t.values(),a=[...r];async function l(e){for(let t of e){let e=await s.files.create({file:t,purpose:"assistants"},n);a.push(e.id)}}let u=Array(o).fill(i).map(l);return await nD(u),await this.createAndPoll(e,{file_ids:a})}}class nX extends nb{constructor(){super(...arguments),this.files=new nU(this._client),this.fileBatches=new nJ(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return r6(e)?this.list({},e):this._client.getAPIList("/vector_stores",nK,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/search`,nQ,{body:t,method:"post",...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class nK extends nv{}class nQ extends nw{}nX.VectorStoresPage=nK,nX.VectorStoreSearchResponsesPage=nQ,nX.Files=nU,nX.VectorStoreFilesPage=nH,nX.FileContentResponsesPage=nV,nX.FileBatches=nJ;class nY extends nb{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return r6(e)?this.list({},e):this._client.getAPIList("/assistants",nG,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class nG extends nv{}function nZ(e){return"function"==typeof e.parse}nY.AssistantsPage=nG;let n0=e=>e?.role==="assistant",n1=e=>e?.role==="function",n2=e=>e?.role==="tool";var n3=function(e,t,r,n,o){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!o)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r},n8=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class n6{constructor(){C.add(this),this.controller=new AbortController,P.set(this,void 0),O.set(this,()=>{}),q.set(this,()=>{}),j.set(this,void 0),$.set(this,()=>{}),I.set(this,()=>{}),L.set(this,{}),M.set(this,!1),B.set(this,!1),W.set(this,!1),F.set(this,!1),n3(this,P,new Promise((e,t)=>{n3(this,O,e,"f"),n3(this,q,t,"f")}),"f"),n3(this,j,new Promise((e,t)=>{n3(this,$,e,"f"),n3(this,I,t,"f")}),"f"),n8(this,P,"f").catch(()=>{}),n8(this,j,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},n8(this,C,"m",z).bind(this))},0)}_connected(){this.ended||(n8(this,O,"f").call(this),this._emit("connect"))}get ended(){return n8(this,M,"f")}get errored(){return n8(this,B,"f")}get aborted(){return n8(this,W,"f")}abort(){this.controller.abort()}on(e,t){return(n8(this,L,"f")[e]||(n8(this,L,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=n8(this,L,"f")[e];if(!r)return this;let n=r.findIndex(e=>e.listener===t);return n>=0&&r.splice(n,1),this}once(e,t){return(n8(this,L,"f")[e]||(n8(this,L,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{n3(this,F,!0,"f"),"error"!==e&&this.once("error",r),this.once(e,t)})}async done(){n3(this,F,!0,"f"),await n8(this,j,"f")}_emit(e,...t){if(n8(this,M,"f"))return;"end"===e&&(n3(this,M,!0,"f"),n8(this,$,"f").call(this));let r=n8(this,L,"f")[e];if(r&&(n8(this,L,"f")[e]=r.filter(e=>!e.once),r.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];n8(this,F,"f")||r?.length||Promise.reject(e),n8(this,q,"f").call(this,e),n8(this,I,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];n8(this,F,"f")||r?.length||Promise.reject(e),n8(this,q,"f").call(this,e),n8(this,I,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function n5(e){return e?.$brand==="auto-parseable-response-format"}function n4(e){return e?.$brand==="auto-parseable-tool"}function n7(e,t){let r=e.choices.map(e=>{var r;if("length"===e.finish_reason)throw new rk;if("content_filter"===e.finish_reason)throw new rR;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>(function(e,t){let r=e.tools?.find(e=>e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:n4(r)?r.$parseRaw(t.function.arguments):r?.function.strict?JSON.parse(t.function.arguments):null}}})(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(r=e.message.content,t.response_format?.type!=="json_schema"?null:t.response_format?.type==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(r):JSON.parse(r):null):null}}});return{...e,choices:r}}function n9(e){return!!n5(e.response_format)||(e.tools?.some(e=>n4(e)||"function"===e.type&&!0===e.function.strict)??!1)}P=new WeakMap,O=new WeakMap,q=new WeakMap,j=new WeakMap,$=new WeakMap,I=new WeakMap,L=new WeakMap,M=new WeakMap,B=new WeakMap,W=new WeakMap,F=new WeakMap,C=new WeakSet,z=function(e){if(n3(this,B,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new rm),e instanceof rm)return n3(this,W,!0,"f"),this._emit("abort",e);if(e instanceof rf)return this._emit("error",e);if(e instanceof Error){let t=new rf(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new rf(String(e)))};var oe=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class ot extends n6{constructor(){super(...arguments),N.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(n1(e)||n2(e))&&e.content)this._emit("functionCallResult",e.content);else if(n0(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(n0(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new rf("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),oe(this,N,"m",D).call(this)}async finalMessage(){return await this.done(),oe(this,N,"m",U).call(this)}async finalFunctionCall(){return await this.done(),oe(this,N,"m",H).call(this)}async finalFunctionCallResult(){return await this.done(),oe(this,N,"m",V).call(this)}async totalUsage(){return await this.done(),oe(this,N,"m",J).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=oe(this,N,"m",U).call(this);t&&this._emit("finalMessage",t);let r=oe(this,N,"m",D).call(this);r&&this._emit("finalContent",r);let n=oe(this,N,"m",H).call(this);n&&this._emit("finalFunctionCall",n);let o=oe(this,N,"m",V).call(this);null!=o&&this._emit("finalFunctionCallResult",o),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",oe(this,N,"m",J).call(this))}async _createChatCompletion(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),oe(this,N,"m",X).call(this,t);let o=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(n7(o,t))}async _runChatCompletion(e,t,r){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){let n="function",{function_call:o="auto",stream:s,...i}=t,a="string"!=typeof o&&o?.name,{maxChatCompletions:l=10}=r||{},u={};for(let e of t.functions)u[e.name||e.function.name]=e;let c=t.functions.map(e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description}));for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t;let s=await this._createChatCompletion(e,{...i,function_call:o,functions:c,messages:[...this.messages]},r),l=s.choices[0]?.message;if(!l)throw new rf("missing message in ChatCompletion response");if(!l.function_call)return;let{name:h,arguments:d}=l.function_call,f=u[h];if(f){if(a&&a!==h){let e=`Invalid function_call: ${JSON.stringify(h)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:n,name:h,content:e});continue}}else{let e=`Invalid function_call: ${JSON.stringify(h)}. Available options are: ${c.map(e=>JSON.stringify(e.name)).join(", ")}. Please try again`;this._addMessage({role:n,name:h,content:e});continue}try{t=nZ(f)?await f.parse(d):d}catch(e){this._addMessage({role:n,name:h,content:e instanceof Error?e.message:String(e)});continue}let p=await f.function(t,this),m=oe(this,N,"m",K).call(this,p);if(this._addMessage({role:n,name:h,content:m}),a)return}}async _runTools(e,t,r){let n="tool",{tool_choice:o="auto",stream:s,...i}=t,a="string"!=typeof o&&o?.function?.name,{maxChatCompletions:l=10}=r||{},u=t.tools.map(e=>{if(n4(e)){if(!e.$callback)throw new rf("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),c={};for(let e of u)"function"===e.type&&(c[e.function.name||e.function.function.name]=e.function);let h="tools"in t?u.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...i,tool_choice:o,tools:h,messages:[...this.messages]},r),s=t.choices[0]?.message;if(!s)throw new rf("missing message in ChatCompletion response");if(!s.tool_calls?.length)break;for(let e of s.tool_calls){let t;if("function"!==e.type)continue;let r=e.id,{name:o,arguments:s}=e.function,i=c[o];if(i){if(a&&a!==o){let e=`Invalid tool_call: ${JSON.stringify(o)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:n,tool_call_id:r,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(o)}. Available options are: ${Object.keys(c).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:r,content:e});continue}try{t=nZ(i)?await i.parse(s):s}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:n,tool_call_id:r,content:e});continue}let l=await i.function(t,this),u=oe(this,N,"m",K).call(this,l);if(this._addMessage({role:n,tool_call_id:r,content:u}),a)return}}}}N=new WeakSet,D=function(){return oe(this,N,"m",U).call(this).content??null},U=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(n0(t)){let{function_call:e,...r}=t,n={...r,content:t.content??null,refusal:t.refusal??null};return e&&(n.function_call=e),n}}throw new rf("stream ended without producing a ChatCompletionMessage with role=assistant")},H=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(n0(t)&&t?.function_call)return t.function_call;if(n0(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},V=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(n1(t)&&null!=t.content||n2(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},J=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},X=function(e){if(null!=e.n&&e.n>1)throw new rf("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},K=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class or extends ot{static runFunctions(e,t,r){let n=new or,o={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run(()=>n._runFunctions(e,t,o)),n}static runTools(e,t,r){let n=new or,o={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,o)),n}_addMessage(e,t=!0){super._addMessage(e,t),n0(e)&&e.content&&this._emit("content",e.content)}}let on={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,ALL:511};class oo extends Error{}class os extends Error{}let oi=(e,t)=>{let r=e.length,n=0,o=e=>{throw new oo(`${e} at position ${n}`)},s=e=>{throw new os(`${e} at position ${n}`)},i=()=>(h(),n>=r&&o("Unexpected end of input"),'"'===e[n])?a():"{"===e[n]?l():"["===e[n]?u():"null"===e.substring(n,n+4)||on.NULL&t&&r-n<4&&"null".startsWith(e.substring(n))?(n+=4,null):"true"===e.substring(n,n+4)||on.BOOL&t&&r-n<4&&"true".startsWith(e.substring(n))?(n+=4,!0):"false"===e.substring(n,n+5)||on.BOOL&t&&r-n<5&&"false".startsWith(e.substring(n))?(n+=5,!1):"Infinity"===e.substring(n,n+8)||on.INFINITY&t&&r-n<8&&"Infinity".startsWith(e.substring(n))?(n+=8,1/0):"-Infinity"===e.substring(n,n+9)||on.MINUS_INFINITY&t&&1<r-n&&r-n<9&&"-Infinity".startsWith(e.substring(n))?(n+=9,-1/0):"NaN"===e.substring(n,n+3)||on.NAN&t&&r-n<3&&"NaN".startsWith(e.substring(n))?(n+=3,NaN):c(),a=()=>{let i=n,a=!1;for(n++;n<r&&('"'!==e[n]||a&&"\\"===e[n-1]);)a="\\"===e[n]&&!a,n++;if('"'==e.charAt(n))try{return JSON.parse(e.substring(i,++n-Number(a)))}catch(e){s(String(e))}else if(on.STR&t)try{return JSON.parse(e.substring(i,n-Number(a))+'"')}catch(t){return JSON.parse(e.substring(i,e.lastIndexOf("\\"))+'"')}o("Unterminated string literal")},l=()=>{n++,h();let s={};try{for(;"}"!==e[n];){if(h(),n>=r&&on.OBJ&t)return s;let o=a();h(),n++;try{let e=i();Object.defineProperty(s,o,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(on.OBJ&t)return s;throw e}h(),","===e[n]&&n++}}catch(e){if(on.OBJ&t)return s;o("Expected '}' at end of object")}return n++,s},u=()=>{n++;let r=[];try{for(;"]"!==e[n];)r.push(i()),h(),","===e[n]&&n++}catch(e){if(on.ARR&t)return r;o("Expected ']' at end of array")}return n++,r},c=()=>{if(0===n){"-"===e&&on.NUM&t&&o("Not sure what '-' is");try{return JSON.parse(e)}catch(r){if(on.NUM&t)try{if("."===e[e.length-1])return JSON.parse(e.substring(0,e.lastIndexOf(".")));return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}s(String(r))}}let i=n;for("-"===e[n]&&n++;e[n]&&!",]}".includes(e[n]);)n++;n!=r||on.NUM&t||o("Unterminated number literal");try{return JSON.parse(e.substring(i,n))}catch(r){"-"===e.substring(i,n)&&on.NUM&t&&o("Not sure what '-' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(e){s(String(e))}}},h=()=>{for(;n<r&&" \n\r	".includes(e[n]);)n++};return i()},oa=e=>(function(e,t=on.ALL){if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return oi(e.trim(),t)})(e,on.ALL^on.NUM);var ol=function(e,t,r,n,o){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!o)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r},ou=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class oc extends ot{constructor(e){super(),Q.add(this),Y.set(this,void 0),G.set(this,void 0),Z.set(this,void 0),ol(this,Y,e,"f"),ol(this,G,[],"f")}get currentChatCompletionSnapshot(){return ou(this,Z,"f")}static fromReadableStream(e){let t=new oc(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let n=new oc(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,r){super._createChatCompletion;let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),ou(this,Q,"m",ee).call(this);let o=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});for await(let e of(this._connected(),o))ou(this,Q,"m",er).call(this,e);if(o.controller.signal?.aborted)throw new rm;return this._addChatCompletion(ou(this,Q,"m",es).call(this))}async _fromReadableStream(e,t){let r;let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),ou(this,Q,"m",ee).call(this),this._connected();let o=rq.fromReadableStream(e,this.controller);for await(let e of o)r&&r!==e.id&&this._addChatCompletion(ou(this,Q,"m",es).call(this)),ou(this,Q,"m",er).call(this,e),r=e.id;if(o.controller.signal?.aborted)throw new rm;return this._addChatCompletion(ou(this,Q,"m",es).call(this))}[(Y=new WeakMap,G=new WeakMap,Z=new WeakMap,Q=new WeakSet,ee=function(){this.ended||ol(this,Z,void 0,"f")},et=function(e){let t=ou(this,G,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},ou(this,G,"f")[e.index]=t),t},er=function(e){if(this.ended)return;let t=ou(this,Q,"m",ea).call(this,e);for(let r of(this._emit("chunk",e,t),e.choices)){let e=t.choices[r.index];null!=r.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",r.delta.content,e.message.content),this._emit("content.delta",{delta:r.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=r.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:r.delta.refusal,snapshot:e.message.refusal}),r.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:r.logprobs?.content,snapshot:e.logprobs?.content??[]}),r.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:r.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let n=ou(this,Q,"m",et).call(this,e);for(let t of(e.finish_reason&&(ou(this,Q,"m",eo).call(this,e),null!=n.current_tool_call_index&&ou(this,Q,"m",en).call(this,e,n.current_tool_call_index)),r.delta.tool_calls??[]))n.current_tool_call_index!==t.index&&(ou(this,Q,"m",eo).call(this,e),null!=n.current_tool_call_index&&ou(this,Q,"m",en).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(let t of r.delta.tool_calls??[]){let r=e.message.tool_calls?.[t.index];r?.type&&(r?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:r.function?.name,index:t.index,arguments:r.function.arguments,parsed_arguments:r.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):r?.type)}}},en=function(e,t){if(ou(this,Q,"m",et).call(this,e).done_tool_calls.has(t))return;let r=e.message.tool_calls?.[t];if(!r)throw Error("no tool call snapshot");if(!r.type)throw Error("tool call snapshot missing `type`");if("function"===r.type){let e=ou(this,Y,"f")?.tools?.find(e=>"function"===e.type&&e.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:t,arguments:r.function.arguments,parsed_arguments:n4(e)?e.$parseRaw(r.function.arguments):e?.function.strict?JSON.parse(r.function.arguments):null})}else r.type},eo=function(e){let t=ou(this,Q,"m",et).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let r=ou(this,Q,"m",ei).call(this);this._emit("content.done",{content:e.message.content,parsed:r?r.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},es=function(){if(this.ended)throw new rf("stream has ended, this shouldn't happen");let e=ou(this,Z,"f");if(!e)throw new rf("request ended without sending any chunks");return ol(this,Z,void 0,"f"),ol(this,G,[],"f"),function(e,t){var r;let{id:n,choices:o,created:s,model:i,system_fingerprint:a,...l}=e;return r={...l,id:n,choices:o.map(({message:t,finish_reason:r,index:n,logprobs:o,...s})=>{if(!r)throw new rf(`missing finish_reason for choice ${n}`);let{content:i=null,function_call:a,tool_calls:l,...u}=t,c=t.role;if(!c)throw new rf(`missing role for choice ${n}`);if(a){let{arguments:e,name:l}=a;if(null==e)throw new rf(`missing function_call.arguments for choice ${n}`);if(!l)throw new rf(`missing function_call.name for choice ${n}`);return{...s,message:{content:i,function_call:{arguments:e,name:l},role:c,refusal:t.refusal??null},finish_reason:r,index:n,logprobs:o}}return l?{...s,index:n,finish_reason:r,logprobs:o,message:{...u,role:c,content:i,refusal:t.refusal??null,tool_calls:l.map((t,r)=>{let{function:o,type:s,id:i,...a}=t,{arguments:l,name:u,...c}=o||{};if(null==i)throw new rf(`missing choices[${n}].tool_calls[${r}].id
${oh(e)}`);if(null==s)throw new rf(`missing choices[${n}].tool_calls[${r}].type
${oh(e)}`);if(null==u)throw new rf(`missing choices[${n}].tool_calls[${r}].function.name
${oh(e)}`);if(null==l)throw new rf(`missing choices[${n}].tool_calls[${r}].function.arguments
${oh(e)}`);return{...a,id:i,type:s,function:{...c,name:u,arguments:l}}})}}:{...s,message:{...u,content:i,role:c,refusal:t.refusal??null},finish_reason:r,index:n,logprobs:o}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}},t&&n9(t)?n7(r,t):{...r,choices:r.choices.map(e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,ou(this,Y,"f"))},ei=function(){let e=ou(this,Y,"f")?.response_format;return n5(e)?e:null},ea=function(e){var t,r,n,o;let s=ou(this,Z,"f"),{choices:i,...a}=e;for(let{delta:i,finish_reason:l,index:u,logprobs:c=null,...h}of(s?Object.assign(s,a):s=ol(this,Z,{...a,choices:[]},"f"),e.choices)){let e=s.choices[u];if(e||(e=s.choices[u]={finish_reason:l,index:u,message:{},logprobs:c,...h}),c){if(e.logprobs){let{content:n,refusal:o,...s}=c;Object.assign(e.logprobs,s),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),o&&((r=e.logprobs).refusal??(r.refusal=[]),e.logprobs.refusal.push(...o))}else e.logprobs=Object.assign({},c)}if(l&&(e.finish_reason=l,ou(this,Y,"f")&&n9(ou(this,Y,"f")))){if("length"===l)throw new rk;if("content_filter"===l)throw new rR}if(Object.assign(e,h),!i)continue;let{content:a,refusal:d,function_call:f,role:p,tool_calls:m,...y}=i;if(Object.assign(e.message,y),d&&(e.message.refusal=(e.message.refusal||"")+d),p&&(e.message.role=p),f&&(e.message.function_call?(f.name&&(e.message.function_call.name=f.name),f.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=f.arguments)):e.message.function_call=f),a&&(e.message.content=(e.message.content||"")+a,!e.message.refusal&&ou(this,Q,"m",ei).call(this)&&(e.message.parsed=oa(e.message.content))),m)for(let{index:t,id:r,type:n,function:s,...i}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let a=(o=e.message.tool_calls)[t]??(o[t]={});Object.assign(a,i),r&&(a.id=r),n&&(a.type=n),s&&(a.function??(a.function={name:s.name??"",arguments:""})),s?.name&&(a.function.name=s.name),s?.arguments&&(a.function.arguments+=s.arguments,function(e,t){if(!e)return!1;let r=e.tools?.find(e=>e.function?.name===t.function.name);return n4(r)||r?.function.strict||!1}(ou(this,Y,"f"),a)&&(a.function.parsed_arguments=oa(a.function.arguments)))}}return s},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",r=>{let n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new rq(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function oh(e){return JSON.stringify(e)}class od extends oc{static fromReadableStream(e){let t=new od(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){let n=new od(null),o={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run(()=>n._runFunctions(e,t,o)),n}static runTools(e,t,r){let n=new od(t),o={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,o)),n}}class of extends nb{parse(e,t){return function(e){for(let t of e??[]){if("function"!==t.type)throw new rf(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new rf(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(t=>n7(t,e))}runFunctions(e,t){return e.stream?od.runFunctions(this._client,e,t):or.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?od.runTools(this._client,e,t):or.runTools(this._client,e,t)}stream(e,t){return oc.createChatCompletion(this._client,e,t)}}class op extends nb{constructor(){super(...arguments),this.completions=new of(this._client)}}(op||(op={})).Completions=of;class om extends nb{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class oy extends nb{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class ob extends nb{constructor(){super(...arguments),this.sessions=new om(this._client),this.transcriptionSessions=new oy(this._client)}}ob.Sessions=om,ob.TranscriptionSessions=oy;var og=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},o_=function(e,t,r,n,o){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!o)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r};class ow extends n6{constructor(){super(...arguments),el.add(this),eu.set(this,[]),ec.set(this,{}),eh.set(this,{}),ed.set(this,void 0),ef.set(this,void 0),ep.set(this,void 0),em.set(this,void 0),ey.set(this,void 0),eb.set(this,void 0),eg.set(this,void 0),e_.set(this,void 0),ew.set(this,void 0)}[(eu=new WeakMap,ec=new WeakMap,eh=new WeakMap,ed=new WeakMap,ef=new WeakMap,ep=new WeakMap,em=new WeakMap,ey=new WeakMap,eb=new WeakMap,eg=new WeakMap,e_=new WeakMap,ew=new WeakMap,el=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new ow;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=rq.fromReadableStream(e,this.controller);for await(let e of n)og(this,el,"m",ev).call(this,e);if(n.controller.signal?.aborted)throw new rm;return this._addRun(og(this,el,"m",eS).call(this))}toReadableStream(){return new rq(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,n,o){let s=new ow;return s._run(()=>s._runToolAssistantStream(e,t,r,n,{...o,headers:{...o?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createToolAssistantStream(e,t,r,n,o){let s=o?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i={...n,stream:!0},a=await e.submitToolOutputs(t,r,i,{...o,signal:this.controller.signal});for await(let e of(this._connected(),a))og(this,el,"m",ev).call(this,e);if(a.controller.signal?.aborted)throw new rm;return this._addRun(og(this,el,"m",eS).call(this))}static createThreadAssistantStream(e,t,r){let n=new ow;return n._run(()=>n._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,r,n){let o=new ow;return o._run(()=>o._runAssistantStream(e,t,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),o}currentEvent(){return og(this,eg,"f")}currentRun(){return og(this,e_,"f")}currentMessageSnapshot(){return og(this,ed,"f")}currentRunStepSnapshot(){return og(this,ew,"f")}async finalRunSteps(){return await this.done(),Object.values(og(this,ec,"f"))}async finalMessages(){return await this.done(),Object.values(og(this,eh,"f"))}async finalRun(){if(await this.done(),!og(this,ef,"f"))throw Error("Final run was not received.");return og(this,ef,"f")}async _createThreadAssistantStream(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let o={...t,stream:!0},s=await e.createAndRun(o,{...r,signal:this.controller.signal});for await(let e of(this._connected(),s))og(this,el,"m",ev).call(this,e);if(s.controller.signal?.aborted)throw new rm;return this._addRun(og(this,el,"m",eS).call(this))}async _createAssistantStream(e,t,r,n){let o=n?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));let s={...r,stream:!0},i=await e.create(t,s,{...n,signal:this.controller.signal});for await(let e of(this._connected(),i))og(this,el,"m",ev).call(this,e);if(i.controller.signal?.aborted)throw new rm;return this._addRun(og(this,el,"m",eS).call(this))}static accumulateDelta(e,t){for(let[r,n]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=n;continue}let t=e[r];if(null==t||"index"===r||"type"===r){e[r]=n;continue}if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else if(ny(t)&&ny(n))t=this.accumulateDelta(t,n);else if(Array.isArray(t)&&Array.isArray(n)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...n);continue}for(let e of n){if(!ny(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let r=e.index;if(null==r)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof r)throw Error(`Expected array delta entry \`index\` property to be a number but got ${r}`);let n=t[r];null==n?t.push(e):t[r]=this.accumulateDelta(n,e)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${n}, accValue: ${t}`);e[r]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,n){return await this._createAssistantStream(t,e,r,n)}async _runToolAssistantStream(e,t,r,n,o){return await this._createToolAssistantStream(r,e,t,n,o)}}ev=function(e){if(!this.ended)switch(o_(this,eg,e,"f"),og(this,el,"m",ex).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":og(this,el,"m",eC).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":og(this,el,"m",eE).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":og(this,el,"m",eT).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},eS=function(){if(this.ended)throw new rf("stream has ended, this shouldn't happen");if(!og(this,ef,"f"))throw Error("Final run has not been received");return og(this,ef,"f")},eT=function(e){let[t,r]=og(this,el,"m",eR).call(this,e,og(this,ed,"f"));for(let e of(o_(this,ed,t,"f"),og(this,eh,"f")[t.id]=t,r)){let r=t.content[e.index];r?.type=="text"&&this._emit("textCreated",r.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let r of e.data.delta.content){if("text"==r.type&&r.text){let e=r.text,n=t.content[r.index];if(n&&"text"==n.type)this._emit("textDelta",e,n.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=og(this,ep,"f")){if(og(this,em,"f"))switch(og(this,em,"f").type){case"text":this._emit("textDone",og(this,em,"f").text,og(this,ed,"f"));break;case"image_file":this._emit("imageFileDone",og(this,em,"f").image_file,og(this,ed,"f"))}o_(this,ep,r.index,"f")}o_(this,em,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==og(this,ep,"f")){let t=e.data.content[og(this,ep,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,og(this,ed,"f"));break;case"text":this._emit("textDone",t.text,og(this,ed,"f"))}}og(this,ed,"f")&&this._emit("messageDone",e.data),o_(this,ed,void 0,"f")}},eE=function(e){let t=og(this,el,"m",ek).call(this,e);switch(o_(this,ew,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&"tool_calls"==r.step_details.type&&r.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of r.step_details.tool_calls)e.index==og(this,ey,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(og(this,eb,"f")&&this._emit("toolCallDone",og(this,eb,"f")),o_(this,ey,e.index,"f"),o_(this,eb,t.step_details.tool_calls[e.index],"f"),og(this,eb,"f")&&this._emit("toolCallCreated",og(this,eb,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":o_(this,ew,void 0,"f"),"tool_calls"==e.data.step_details.type&&og(this,eb,"f")&&(this._emit("toolCallDone",og(this,eb,"f")),o_(this,eb,void 0,"f")),this._emit("runStepDone",e.data,t)}},ex=function(e){og(this,eu,"f").push(e),this._emit("event",e)},ek=function(e){switch(e.event){case"thread.run.step.created":return og(this,ec,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=og(this,ec,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let n=ow.accumulateDelta(t,r.delta);og(this,ec,"f")[e.data.id]=n}return og(this,ec,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":og(this,ec,"f")[e.data.id]=e.data}if(og(this,ec,"f")[e.data.id])return og(this,ec,"f")[e.data.id];throw Error("No snapshot available")},eR=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let e of n.delta.content)if(e.index in t.content){let r=t.content[e.index];t.content[e.index]=og(this,el,"m",eA).call(this,e,r)}else t.content[e.index]=e,r.push(e);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},eA=function(e,t){return ow.accumulateDelta(t,e)},eC=function(e){switch(o_(this,e_,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":o_(this,ef,e.data,"f"),og(this,eb,"f")&&(this._emit("toolCallDone",og(this,eb,"f")),o_(this,eb,void 0,"f"))}};class ov extends nb{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,n){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},r){return r6(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,oS,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class oS extends nv{}ov.MessagesPage=oS;class oT extends nb{retrieve(e,t,r,n={},o){return r6(n)?this.retrieve(e,t,r,{},n):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:n,...o,headers:{"OpenAI-Beta":"assistants=v2",...o?.headers}})}list(e,t,r={},n){return r6(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,oE,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class oE extends nv{}oT.RunStepsPage=oE;class ox extends nb{constructor(){super(...arguments),this.steps=new oT(this._client)}create(e,t,r){let{include:n,...o}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:n},body:o,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,n){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},r){return r6(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,ok,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(e,n.id,r)}createAndStream(e,t,r){return ow.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let n={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:o,response:s}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...n}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let i=5e3;if(r?.pollIntervalMs)i=r.pollIntervalMs;else{let e=s.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await nn(i);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}}stream(e,t,r){return ow.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,n){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,n){let o=await this.submitToolOutputs(e,t,r,n);return await this.poll(e,o.id,n)}submitToolOutputsStream(e,t,r,n){return ow.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,n)}}class ok extends nv{}ox.RunsPage=ok,ox.Steps=oT,ox.RunStepsPage=oE;class oR extends nb{constructor(){super(...arguments),this.runs=new ox(this._client),this.messages=new ov(this._client)}create(e={},t){return r6(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return ow.createThreadAssistantStream(e,this._client.beta.threads,t)}}oR.Runs=ox,oR.RunsPage=ok,oR.Messages=ov,oR.MessagesPage=oS;class oA extends nb{constructor(){super(...arguments),this.realtime=new ob(this._client),this.chat=new op(this._client),this.assistants=new nY(this._client),this.threads=new oR(this._client)}}oA.Realtime=ob,oA.Assistants=nY,oA.AssistantsPage=nG,oA.Threads=oR;class oC extends nb{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return r6(e)?this.list({},e):this._client.getAPIList("/batches",oP,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class oP extends nv{}oC.BatchesPage=oP;class oO extends nb{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,rH({body:t,...r}))}}class oq extends nb{constructor(){super(...arguments),this.parts=new oO(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}}function oj(e,t){let r=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var r,n,o;let s=(r=e.tools??[],n=t.name,r.find(e=>"function"===e.type&&e.name===n));return{...t,...t,parsed_arguments:(o=s,o?.$brand==="auto-parseable-tool")?s.$parseRaw(t.arguments):s?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let r=e.content.map(e=>{var r;return"output_text"===e.type?{...e,parsed:(r=e.text,t.text?.format?.type!=="json_schema"?null:"$parseRaw"in t.text?.format?(t.text?.format).$parseRaw(r):JSON.parse(r))}:e});return{...e,content:r}}return e}),n=Object.assign({},e,{output:r});return Object.getOwnPropertyDescriptor(e,"output_text")||o$(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let e of n.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),n}function o$(e){let t=[];for(let r of e.output)if("message"===r.type)for(let e of r.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}oq.Parts=oO;class oI extends nb{list(e,t={},r){return r6(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,oF,{query:t,...r})}}var oL=function(e,t,r,n,o){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!o)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r},oM=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class oB extends n6{constructor(e){super(),eP.add(this),eO.set(this,void 0),eq.set(this,void 0),ej.set(this,void 0),oL(this,eO,e,"f")}static createResponse(e,t,r){let n=new oB(t);return n._run(()=>n._createResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createResponse(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),oM(this,eP,"m",e$).call(this);let o=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal});for await(let e of(this._connected(),o))oM(this,eP,"m",eI).call(this,e);if(o.controller.signal?.aborted)throw new rm;return oM(this,eP,"m",eL).call(this)}[(eO=new WeakMap,eq=new WeakMap,ej=new WeakMap,eP=new WeakSet,e$=function(){this.ended||oL(this,eq,void 0,"f")},eI=function(e){if(this.ended)return;let t=oM(this,eP,"m",eM).call(this,e);switch(this._emit("event",e),e.type){case"response.output_text.delta":{let r=t.output[e.output_index];if(!r)throw new rf(`missing output at index ${e.output_index}`);if("message"===r.type){let t=r.content[e.content_index];if(!t)throw new rf(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new rf(`expected content to be 'output_text', got ${t.type}`);this._emit("response.output_text.delta",{...e,snapshot:t.text})}break}case"response.function_call_arguments.delta":{let r=t.output[e.output_index];if(!r)throw new rf(`missing output at index ${e.output_index}`);"function_call"===r.type&&this._emit("response.function_call_arguments.delta",{...e,snapshot:r.arguments});break}default:this._emit(e.type,e)}},eL=function(){if(this.ended)throw new rf("stream has ended, this shouldn't happen");let e=oM(this,eq,"f");if(!e)throw new rf("request ended without sending any events");oL(this,eq,void 0,"f");let t=function(e,t){return t&&n5(t.text?.format)?oj(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,oM(this,eO,"f"));return oL(this,ej,t,"f"),t},eM=function(e){let t=oM(this,eq,"f");if(!t){if("response.created"!==e.type)throw new rf(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return oL(this,eq,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let r=t.output[e.output_index];if(!r)throw new rf(`missing output at index ${e.output_index}`);"message"===r.type&&r.content.push(e.part);break}case"response.output_text.delta":{let r=t.output[e.output_index];if(!r)throw new rf(`missing output at index ${e.output_index}`);if("message"===r.type){let t=r.content[e.content_index];if(!t)throw new rf(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new rf(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let r=t.output[e.output_index];if(!r)throw new rf(`missing output at index ${e.output_index}`);"function_call"===r.type&&(r.arguments+=e.delta);break}case"response.completed":oL(this,eq,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=oM(this,ej,"f");if(!e)throw new rf("stream ended without producing a ChatCompletion");return e}}class oW extends nb{constructor(){super(...arguments),this.inputItems=new oI(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&o$(e),e))}retrieve(e,t={},r){return r6(t)?this.retrieve(e,{},t):this._client.get(`/responses/${e}`,{query:t,...r})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>oj(t,e))}stream(e,t){return oB.createResponse(this._client,e,t)}}class oF extends nv{}oW.InputItems=oI;class oz extends r0{constructor({baseURL:e=ni("OPENAI_BASE_URL"),apiKey:t=ni("OPENAI_API_KEY"),organization:r=ni("OPENAI_ORG_ID")??null,project:n=ni("OPENAI_PROJECT_ID")??null,...o}={}){if(void 0===t)throw new rf("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let s={apiKey:t,organization:r,project:n,...o,baseURL:e||"https://api.openai.com/v1"};if(!s.dangerouslyAllowBrowser&&nf())throw new rf("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:s.baseURL,timeout:s.timeout??6e5,httpAgent:s.httpAgent,maxRetries:s.maxRetries,fetch:s.fetch}),this.completions=new ng(this),this.chat=new nx(this),this.embeddings=new nk(this),this.files=new nR(this),this.images=new nC(this),this.audio=new nj(this),this.moderations=new n$(this),this.models=new nI(this),this.fineTuning=new nN(this),this.vectorStores=new nX(this),this.beta=new oA(this),this.batches=new oC(this),this.uploads=new oq(this),this.responses=new oW(this),this._options=s,this.apiKey=t,this.organization=r,this.project=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return function(e,t={}){let r,n=e,o=function(e=e2){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let r=e.charset||e2.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=eH;if(void 0!==e.format){if(!eQ.call(eV,e.format))throw TypeError("Unknown format option provided.");n=e.format}let o=eV[n],s=e2.filter;if(("function"==typeof e.filter||eG(e.filter))&&(s=e.filter),t=e.arrayFormat&&e.arrayFormat in eY?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":e2.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let i=void 0===e.allowDots?!0==!!e.encodeDotInKeys||e2.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:e2.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:e2.allowEmptyArrays,arrayFormat:t,charset:r,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:e2.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?e2.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:e2.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:e2.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:e2.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:e2.encodeValuesOnly,filter:s,format:n,formatter:o,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:e2.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:e2.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:e2.strictNullHandling}}(t);"function"==typeof o.filter?n=(0,o.filter)("",n):eG(o.filter)&&(r=o.filter);let s=[];if("object"!=typeof n||null===n)return"";let i=eY[o.arrayFormat],a="comma"===i&&o.commaRoundTrip;r||(r=Object.keys(n)),o.sort&&r.sort(o.sort);let l=new WeakMap;for(let e=0;e<r.length;++e){let t=r[e];o.skipNulls&&null===n[t]||e0(s,function e(t,r,n,o,s,i,a,l,u,c,h,d,f,p,m,y,b,g){var _,w;let v,S=t,T=g,E=0,x=!1;for(;void 0!==(T=T.get(e3))&&!x;){let e=T.get(t);if(E+=1,void 0!==e){if(e===E)throw RangeError("Cyclic object value");x=!0}void 0===T.get(e3)&&(E=0)}if("function"==typeof c?S=c(r,S):S instanceof Date?S=f?.(S):"comma"===n&&eG(S)&&(S=eK(S,function(e){return e instanceof Date?f?.(e):e})),null===S){if(i)return u&&!y?u(r,e2.encoder,b,"key",p):r;S=""}if("string"==typeof(_=S)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||(w=S)&&"object"==typeof w&&w.constructor&&w.constructor.isBuffer&&w.constructor.isBuffer(w)){if(u){let e=y?r:u(r,e2.encoder,b,"key",p);return[m?.(e)+"="+m?.(u(S,e2.encoder,b,"value",p))]}return[m?.(r)+"="+m?.(String(S))]}let k=[];if(void 0===S)return k;if("comma"===n&&eG(S))y&&u&&(S=eK(S,u)),v=[{value:S.length>0?S.join(",")||null:void 0}];else if(eG(c))v=c;else{let e=Object.keys(S);v=h?e.sort(h):e}let R=l?String(r).replace(/\./g,"%2E"):String(r),A=o&&eG(S)&&1===S.length?R+"[]":R;if(s&&eG(S)&&0===S.length)return A+"[]";for(let r=0;r<v.length;++r){let _=v[r],w="object"==typeof _&&void 0!==_.value?_.value:S[_];if(a&&null===w)continue;let T=d&&l?_.replace(/\./g,"%2E"):_,x=eG(S)?"function"==typeof n?n(A,T):A:A+(d?"."+T:"["+T+"]");g.set(t,E);let R=new WeakMap;R.set(e3,g),e0(k,e(w,x,n,o,s,i,a,l,"comma"===n&&y&&eG(S)?null:u,c,h,d,f,p,m,y,b,R))}return k}(n[t],t,i,a,o.allowEmptyArrays,o.strictNullHandling,o.skipNulls,o.encodeDotInKeys,o.encode?o.encoder:null,o.filter,o.sort,o.allowDots,o.serializeDate,o.format,o.formatter,o.encodeValuesOnly,o.charset,l))}let u=s.join(o.delimiter),c=!0===o.addQueryPrefix?"?":"";return o.charsetSentinel&&("iso-8859-1"===o.charset?c+="utf8=%26%2310003%3B&":c+="utf8=%E2%9C%93&"),u.length>0?c+u:""}(e,{arrayFormat:"brackets"})}}oz.OpenAI=oz,oz.DEFAULT_TIMEOUT=6e5,oz.OpenAIError=rf,oz.APIError=rp,oz.APIConnectionError=ry,oz.APIConnectionTimeoutError=rb,oz.APIUserAbortError=rm,oz.NotFoundError=rv,oz.ConflictError=rS,oz.RateLimitError=rE,oz.BadRequestError=rg,oz.AuthenticationError=r_,oz.InternalServerError=rx,oz.PermissionDeniedError=rw,oz.UnprocessableEntityError=rT,oz.toFile=rF,oz.fileFromPath=d,oz.Completions=ng,oz.Chat=nx,oz.ChatCompletionsPage=nT,oz.Embeddings=nk,oz.Files=nR,oz.FileObjectsPage=nA,oz.Images=nC,oz.Audio=nj,oz.Moderations=n$,oz.Models=nI,oz.ModelsPage=nL,oz.FineTuning=nN,oz.VectorStores=nX,oz.VectorStoresPage=nK,oz.VectorStoreSearchResponsesPage=nQ,oz.Beta=oA,oz.Batches=oC,oz.BatchesPage=oP,oz.Uploads=oq,oz.Responses=oW;let oN=new oz({apiKey:process.env.OPENAI_API_KEY});async function oD(e){let{wanikani_level:t,genki_chapter:r,tadoku_level:n,length:o,topic:s}=e,i=0;for(;i<3;)try{let e=`Generate a Japanese story with the following requirements:
- Wanikani level: ${t}
- Genki chapter: ${r}
- Tadoku level: ${n}
- Length: ${o}
- Topic: ${s}

Please provide:
1. A title in Japanese and English
2. The story in Japanese
3. The story in English
4. A list of vocabulary words with readings and meanings
5. A list of grammar points with explanations
6. Example sentences for each vocabulary word and grammar point from the story
7. Multiple choice quiz questions for:
   - EVERY vocabulary word (testing meaning and usage)
   - EVERY grammar point (testing understanding and application)
   - Story comprehension (3-4 questions testing understanding of the story's content, main ideas, and details)

CRITICAL REQUIREMENTS:
1. You MUST create EXACTLY one quiz question for each vocabulary word
2. You MUST create EXACTLY one quiz question for each grammar point
3. The number of vocabulary quizzes MUST equal the number of vocabulary words
4. The number of grammar quizzes MUST equal the number of grammar points
5. Each vocabulary quiz MUST include the word it's testing in the 'related_item' field
6. Each grammar quiz MUST include the pattern it's testing in the 'related_item' field

Format the response as JSON with the following structure:
{
  "title": {
    "jp": "Japanese title",
    "en": "English title"
  },
  "content_jp": "Japanese story text",
  "content_en": "English story text",
  "vocabulary": [
    {
      "word": "word in Japanese",
      "reading": "reading in hiragana",
      "meaning": "English meaning",
      "example": "example sentence from story",
      "example_translation": "English translation of example"
    }
  ],
  "grammar": [
    {
      "pattern": "grammar pattern",
      "explanation": "English explanation",
      "example": "example sentence from story",
      "example_translation": "English translation of example"
    }
  ],
  "quizzes": [
    {
      "question": "quiz question",
      "options": ["option 1", "option 2", "option 3", "option 4"],
      "correct_answer": 0,
      "explanation": "explanation of the correct answer",
      "type": "vocabulary|grammar|comprehension",
      "related_item": "word or pattern (for vocabulary/grammar quizzes)"
    }
  ]
}`,i=(await oN.chat.completions.create({model:"gpt-4-turbo-preview",messages:[{role:"system",content:"You are a Japanese language teacher creating graded readers and quizzes. Always provide accurate Japanese text and translations. Create engaging stories with clear plot points that can be tested in comprehension questions. You MUST create EXACTLY one quiz question for each vocabulary word and grammar point. The number of quizzes must match the number of vocabulary words and grammar points exactly."},{role:"user",content:e}],response_format:{type:"json_object"},temperature:.7})).choices[0].message.content;if(!i)throw Error("No response from OpenAI");let a=JSON.parse(i),l=a.quizzes.filter(e=>"vocabulary"===e.type),u=a.quizzes.filter(e=>"grammar"===e.type);if(l.length!==a.vocabulary.length)throw Error(`Mismatch: ${l.length} vocabulary quizzes for ${a.vocabulary.length} vocabulary words`);if(u.length!==a.grammar.length)throw Error(`Mismatch: ${u.length} grammar quizzes for ${a.grammar.length} grammar points`);let c=new Set(a.vocabulary.map(e=>e.word)),h=new Set(a.grammar.map(e=>e.pattern)),d=new Set(l.map(e=>e.related_item)),f=new Set(u.map(e=>e.related_item)),p=Array.from(c).filter(e=>!d.has(e)),m=Array.from(h).filter(e=>!f.has(e));if(p.length>0)throw Error(`Missing quizzes for vocabulary words: ${p.join(", ")}`);if(m.length>0)throw Error(`Missing quizzes for grammar patterns: ${m.join(", ")}`);return{title:a.title.jp,content_jp:a.content_jp,content_en:a.content_en,vocabulary:a.vocabulary,grammar:a.grammar,quizzes:a.quizzes}}catch(e){if(3==++i)throw console.error("Error parsing OpenAI response:",e),Error("Failed to generate valid story after multiple attempts");console.log(`Attempt ${i} failed, retrying...`),await new Promise(e=>setTimeout(e,1e3))}throw Error("Failed to generate valid story after multiple attempts")}async function oU(e){try{let t=(0,eN.createRouteHandlerClient)({cookies:eD.cookies}),{data:{session:r}}=await t.auth.getSession();if(!r)return eU.Z.json({error:"Unauthorized"},{status:401});let{wanikaniLevel:n,genkiChapter:o,tadokuLevel:s,topic:i}=await e.json();if(!n||!o||!s||!i)return eU.Z.json({error:"Missing required fields"},{status:400});let a=await oD({wanikani_level:n,genki_chapter:o,tadoku_level:s,length:"medium",topic:i}),l={user_id:r.user.id,title:a.title,content_jp:a.content_jp,content_en:a.content_en,wanikani_level:n,genki_chapter:o,tadoku_level:s,topic:i,vocabulary:a.vocabulary||[],grammar:a.grammar||[],quizzes:a.quizzes||[],upvotes:0},{data:u,error:c}=await t.from("stories").insert(l).select().single();if(c)return console.error("Error saving story:",c),eU.Z.json({error:"Failed to save story"},{status:500});return eU.Z.json(u)}catch(e){return console.error("Error generating story:",e),eU.Z.json({error:"Failed to generate story"},{status:500})}}let oH=new eW.AppRouteRouteModule({definition:{kind:eF.x.APP_ROUTE,page:"/api/stories/generate/route",pathname:"/api/stories/generate",filename:"route",bundlePath:"app/api/stories/generate/route"},resolvedPagePath:"/root/todakugenv2/src/app/api/stories/generate/route.ts",nextConfigOutput:"standalone",userland:eB}),{requestAsyncStorage:oV,staticGenerationAsyncStorage:oJ,serverHooks:oX,headerHooks:oK,staticGenerationBailout:oQ}=oH,oY="/api/stories/generate/route";function oG(){return(0,ez.patchFetch)({serverHooks:oX,staticGenerationAsyncStorage:oJ})}},3843:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(8747);class o extends n.EventTarget{constructor(){throw super(),TypeError("AbortSignal cannot be constructed directly")}get aborted(){let e=s.get(this);if("boolean"!=typeof e)throw TypeError(`Expected 'this' to be an 'AbortSignal' object, but got ${this===null?"null":typeof this}`);return e}}n.defineEventAttribute(o.prototype,"abort");let s=new WeakMap;Object.defineProperties(o.prototype,{aborted:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(o.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});class i{constructor(){a.set(this,function(){let e=Object.create(o.prototype);return n.EventTarget.call(e),s.set(e,!1),e}())}get signal(){return l(this)}abort(){var e;e=l(this),!1===s.get(e)&&(s.set(e,!0),e.dispatchEvent({type:"abort"}))}}let a=new WeakMap;function l(e){let t=a.get(e);if(null==t)throw TypeError(`Expected 'this' to be an 'AbortController' object, but got ${null===e?"null":typeof e}`);return t}Object.defineProperties(i.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(i.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"}),t.AbortController=i,t.AbortSignal=o,t.default=i,e.exports=i,e.exports.AbortController=e.exports.default=i,e.exports.AbortSignal=o},5685:(e,t,r)=>{let n=r(6502);e.exports=n,e.exports.HttpAgent=n,e.exports.HttpsAgent=r(2778),e.exports.constants=r(730)},6502:(e,t,r)=>{let n=r(3685).Agent,o=r(8113),s=r(3837).debuglog("agentkeepalive"),{INIT_SOCKET:i,CURRENT_ID:a,CREATE_ID:l,SOCKET_CREATED_TIME:u,SOCKET_NAME:c,SOCKET_REQUEST_COUNT:h,SOCKET_REQUEST_FINISHED_COUNT:d}=r(730),f=1,p=parseInt(process.version.split(".",1)[0].substring(1));function m(e){console.log("[agentkeepalive:deprecated] %s",e)}p>=11&&p<=12?f=2:p>=13&&(f=3);class y extends n{constructor(e){(e=e||{}).keepAlive=!1!==e.keepAlive,void 0===e.freeSocketTimeout&&(e.freeSocketTimeout=4e3),e.keepAliveTimeout&&(m("options.keepAliveTimeout is deprecated, please use options.freeSocketTimeout instead"),e.freeSocketTimeout=e.keepAliveTimeout,delete e.keepAliveTimeout),e.freeSocketKeepAliveTimeout&&(m("options.freeSocketKeepAliveTimeout is deprecated, please use options.freeSocketTimeout instead"),e.freeSocketTimeout=e.freeSocketKeepAliveTimeout,delete e.freeSocketKeepAliveTimeout),void 0===e.timeout&&(e.timeout=Math.max(2*e.freeSocketTimeout,8e3)),e.timeout=o(e.timeout),e.freeSocketTimeout=o(e.freeSocketTimeout),e.socketActiveTTL=e.socketActiveTTL?o(e.socketActiveTTL):0,super(e),this[a]=0,this.createSocketCount=0,this.createSocketCountLastCheck=0,this.createSocketErrorCount=0,this.createSocketErrorCountLastCheck=0,this.closeSocketCount=0,this.closeSocketCountLastCheck=0,this.errorSocketCount=0,this.errorSocketCountLastCheck=0,this.requestCount=0,this.requestCountLastCheck=0,this.timeoutSocketCount=0,this.timeoutSocketCountLastCheck=0,this.on("free",e=>{let t=this.calcSocketTimeout(e);t>0&&e.timeout!==t&&e.setTimeout(t)})}get freeSocketKeepAliveTimeout(){return m("agent.freeSocketKeepAliveTimeout is deprecated, please use agent.options.freeSocketTimeout instead"),this.options.freeSocketTimeout}get timeout(){return m("agent.timeout is deprecated, please use agent.options.timeout instead"),this.options.timeout}get socketActiveTTL(){return m("agent.socketActiveTTL is deprecated, please use agent.options.socketActiveTTL instead"),this.options.socketActiveTTL}calcSocketTimeout(e){let t=this.options.freeSocketTimeout,r=this.options.socketActiveTTL;if(r){let n=r-(Date.now()-e[u]);if(n<=0)return n;t&&n<t&&(t=n)}if(t)return e.freeSocketTimeout||e.freeSocketKeepAliveTimeout||t}keepSocketAlive(e){let t=super.keepSocketAlive(e);if(!t)return t;let r=this.calcSocketTimeout(e);return void 0===r||(r<=0?(s("%s(requests: %s, finished: %s) free but need to destroy by TTL, request count %s, diff is %s",e[c],e[h],e[d],r),!1):(e.timeout!==r&&e.setTimeout(r),!0))}reuseSocket(...e){super.reuseSocket(...e);let t=e[0];e[1].reusedSocket=!0;let r=this.options.timeout;b(t)!==r&&(t.setTimeout(r),s("%s reset timeout to %sms",t[c],r)),t[h]++,s("%s(requests: %s, finished: %s) reuse on addRequest, timeout %sms",t[c],t[h],t[d],b(t))}[l](){let e=this[a]++;return this[a]===Number.MAX_SAFE_INTEGER&&(this[a]=0),e}[i](e,t){t.timeout&&!b(e)&&e.setTimeout(t.timeout),this.options.keepAlive&&e.setNoDelay(!0),this.createSocketCount++,this.options.socketActiveTTL&&(e[u]=Date.now()),e[c]=`sock[${this[l]()}#${t._agentKey}]`.split("-----BEGIN",1)[0],e[h]=1,e[d]=0,function(e,t,r){function n(){if(!t._httpMessage&&1===t[h])return;t[d]++,e.requestCount++,s("%s(requests: %s, finished: %s) free",t[c],t[h],t[d]);let n=e.getName(r);t.writable&&e.requests[n]&&e.requests[n].length&&(t[h]++,s("%s(requests: %s, finished: %s) will be reuse on agent free event",t[c],t[h],t[d]))}function o(r){s("%s(requests: %s, finished: %s) close, isError: %s",t[c],t[h],t[d],r),e.closeSocketCount++}function i(){let n=t.listeners("timeout").length,o=b(t),i=t._httpMessage,a=i&&i.listeners("timeout").length||0;s("%s(requests: %s, finished: %s) timeout after %sms, listeners %s, defaultTimeoutListenerCount %s, hasHttpRequest %s, HttpRequest timeoutListenerCount %s",t[c],t[h],t[d],o,n,f,!!i,a),s.enabled&&s("timeout listeners: %s",t.listeners("timeout").map(e=>e.name).join(", ")),e.timeoutSocketCount++;let l=e.getName(r);if(e.freeSockets[l]&&-1!==e.freeSockets[l].indexOf(t))t.destroy(),e.removeSocket(t,r),s("%s is free, destroy quietly",t[c]);else if(0===a){let n=Error("Socket timeout");n.code="ERR_SOCKET_TIMEOUT",n.timeout=o,t.destroy(n),e.removeSocket(t,r),s("%s destroy with timeout error",t[c])}}function a(r){let n=t.listeners("error").length;s("%s(requests: %s, finished: %s) error: %s, listenerCount: %s",t[c],t[h],t[d],r,n),e.errorSocketCount++,1===n&&(s("%s emit uncaught error event",t[c]),t.removeListener("error",a),t.emit("error",r))}s("%s create, timeout %sms",t[c],b(t)),t.on("free",n),t.on("close",o),t.on("timeout",i),t.on("error",a),t.on("agentRemove",function e(){s("%s(requests: %s, finished: %s) agentRemove",t[c],t[h],t[d]),t.removeListener("close",o),t.removeListener("error",a),t.removeListener("free",n),t.removeListener("timeout",i),t.removeListener("agentRemove",e)})}(this,e,t)}createConnection(e,t){let r=!1,n=(n,o)=>{if(!r){if(r=!0,n)return this.createSocketErrorCount++,t(n);this[i](o,e),t(n,o)}},o=super.createConnection(e,n);return o&&n(null,o),o}get statusChanged(){let e=this.createSocketCount!==this.createSocketCountLastCheck||this.createSocketErrorCount!==this.createSocketErrorCountLastCheck||this.closeSocketCount!==this.closeSocketCountLastCheck||this.errorSocketCount!==this.errorSocketCountLastCheck||this.timeoutSocketCount!==this.timeoutSocketCountLastCheck||this.requestCount!==this.requestCountLastCheck;return e&&(this.createSocketCountLastCheck=this.createSocketCount,this.createSocketErrorCountLastCheck=this.createSocketErrorCount,this.closeSocketCountLastCheck=this.closeSocketCount,this.errorSocketCountLastCheck=this.errorSocketCount,this.timeoutSocketCountLastCheck=this.timeoutSocketCount,this.requestCountLastCheck=this.requestCount),e}getCurrentStatus(){return{createSocketCount:this.createSocketCount,createSocketErrorCount:this.createSocketErrorCount,closeSocketCount:this.closeSocketCount,errorSocketCount:this.errorSocketCount,timeoutSocketCount:this.timeoutSocketCount,requestCount:this.requestCount,freeSockets:g(this.freeSockets),sockets:g(this.sockets),requests:g(this.requests)}}}function b(e){return e.timeout||e._idleTimeout}function g(e){let t={};for(let r in e)t[r]=e[r].length;return t}e.exports=y},730:e=>{e.exports={CURRENT_ID:Symbol("agentkeepalive#currentId"),CREATE_ID:Symbol("agentkeepalive#createId"),INIT_SOCKET:Symbol("agentkeepalive#initSocket"),CREATE_HTTPS_CONNECTION:Symbol("agentkeepalive#createHttpsConnection"),SOCKET_CREATED_TIME:Symbol("agentkeepalive#socketCreatedTime"),SOCKET_NAME:Symbol("agentkeepalive#socketName"),SOCKET_REQUEST_COUNT:Symbol("agentkeepalive#socketRequestCount"),SOCKET_REQUEST_FINISHED_COUNT:Symbol("agentkeepalive#socketRequestFinishedCount")}},2778:(e,t,r)=>{let n=r(5687).Agent,o=r(6502),{INIT_SOCKET:s,CREATE_HTTPS_CONNECTION:i}=r(730);class a extends o{constructor(e){super(e),this.defaultPort=443,this.protocol="https:",this.maxCachedSessions=this.options.maxCachedSessions,void 0===this.maxCachedSessions&&(this.maxCachedSessions=100),this._sessionCache={map:{},list:[]}}createConnection(e,t){let r=this[i](e,t);return this[s](r,e),r}}a.prototype[i]=n.prototype.createConnection,["getName","_getSession","_cacheSession","_evictSession"].forEach(function(e){"function"==typeof n.prototype[e]&&(a.prototype[e]=n.prototype[e])}),e.exports=a},8747:(e,t)=>{/**
 * @author Toru Nagashima <https://github.com/mysticatea>
 * @copyright 2015 Toru Nagashima. All rights reserved.
 * See LICENSE file in root directory for full license.
 */Object.defineProperty(t,"__esModule",{value:!0});let r=new WeakMap,n=new WeakMap;function o(e){let t=r.get(e);return console.assert(null!=t,"'this' is expected an Event object, but got",e),t}function s(e){if(null!=e.passiveListener){"undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener);return}e.event.cancelable&&(e.canceled=!0,"function"==typeof e.event.preventDefault&&e.event.preventDefault())}function i(e,t){r.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});let n=Object.keys(t);for(let e=0;e<n.length;++e){let t=n[e];t in this||Object.defineProperty(this,t,a(t))}}function a(e){return{get(){return o(this).event[e]},set(t){o(this).event[e]=t},configurable:!0,enumerable:!0}}function l(e,t){o(e).passiveListener=t}i.prototype={get type(){return o(this).event.type},get target(){return o(this).eventTarget},get currentTarget(){return o(this).currentTarget},composedPath(){let e=o(this).currentTarget;return null==e?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return o(this).eventPhase},stopPropagation(){let e=o(this);e.stopped=!0,"function"==typeof e.event.stopPropagation&&e.event.stopPropagation()},stopImmediatePropagation(){let e=o(this);e.stopped=!0,e.immediateStopped=!0,"function"==typeof e.event.stopImmediatePropagation&&e.event.stopImmediatePropagation()},get bubbles(){return!!o(this).event.bubbles},get cancelable(){return!!o(this).event.cancelable},preventDefault(){s(o(this))},get defaultPrevented(){return o(this).canceled},get composed(){return!!o(this).event.composed},get timeStamp(){return o(this).timeStamp},get srcElement(){return o(this).eventTarget},get cancelBubble(){return o(this).stopped},set cancelBubble(value){if(!value)return;let e=o(this);e.stopped=!0,"boolean"==typeof e.event.cancelBubble&&(e.event.cancelBubble=!0)},get returnValue(){return!o(this).canceled},set returnValue(value){value||s(o(this))},initEvent(){}},Object.defineProperty(i.prototype,"constructor",{value:i,configurable:!0,writable:!0});let u=new WeakMap;function c(e){return null!==e&&"object"==typeof e}function h(e){let t=u.get(e);if(null==t)throw TypeError("'this' is expected an EventTarget object, but got another value.");return t}function d(e,t){Object.defineProperty(e,`on${t}`,{get(){let e=h(this).get(t);for(;null!=e;){if(3===e.listenerType)return e.listener;e=e.next}return null},set(e){"function"==typeof e||c(e)||(e=null);let r=h(this),n=null,o=r.get(t);for(;null!=o;)3===o.listenerType?null!==n?n.next=o.next:null!==o.next?r.set(t,o.next):r.delete(t):n=o,o=o.next;if(null!==e){let o={listener:e,listenerType:3,passive:!1,once:!1,next:null};null===n?r.set(t,o):n.next=o}},configurable:!0,enumerable:!0})}function f(e){function t(){p.call(this)}t.prototype=Object.create(p.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(let r=0;r<e.length;++r)d(t.prototype,e[r]);return t}function p(){if(this instanceof p){u.set(this,new Map);return}if(1==arguments.length&&Array.isArray(arguments[0]))return f(arguments[0]);if(arguments.length>0){let e=Array(arguments.length);for(let t=0;t<arguments.length;++t)e[t]=arguments[t];return f(e)}throw TypeError("Cannot call a class as a function")}p.prototype={addEventListener(e,t,r){if(null==t)return;if("function"!=typeof t&&!c(t))throw TypeError("'listener' should be a function or an object.");let n=h(this),o=c(r),s=(o?r.capture:r)?1:2,i={listener:t,listenerType:s,passive:o&&!!r.passive,once:o&&!!r.once,next:null},a=n.get(e);if(void 0===a){n.set(e,i);return}let l=null;for(;null!=a;){if(a.listener===t&&a.listenerType===s)return;l=a,a=a.next}l.next=i},removeEventListener(e,t,r){if(null==t)return;let n=h(this),o=(c(r)?r.capture:r)?1:2,s=null,i=n.get(e);for(;null!=i;){if(i.listener===t&&i.listenerType===o){null!==s?s.next=i.next:null!==i.next?n.set(e,i.next):n.delete(e);return}s=i,i=i.next}},dispatchEvent(e){if(null==e||"string"!=typeof e.type)throw TypeError('"event.type" should be a string.');let t=h(this),r=e.type,s=t.get(r);if(null==s)return!0;let u=new(function e(t){if(null==t||t===Object.prototype)return i;let r=n.get(t);return null==r&&(r=function(e,t){let r=Object.keys(t);if(0===r.length)return e;function n(t,r){e.call(this,t,r)}n.prototype=Object.create(e.prototype,{constructor:{value:n,configurable:!0,writable:!0}});for(let s=0;s<r.length;++s){let i=r[s];if(!(i in e.prototype)){let e="function"==typeof Object.getOwnPropertyDescriptor(t,i).value;Object.defineProperty(n.prototype,i,e?function(e){return{value(){let t=o(this).event;return t[e].apply(t,arguments)},configurable:!0,enumerable:!0}}(i):a(i))}}return n}(e(Object.getPrototypeOf(t)),t),n.set(t,r)),r}(Object.getPrototypeOf(e)))(this,e),c=null;for(;null!=s;){if(s.once?null!==c?c.next=s.next:null!==s.next?t.set(r,s.next):t.delete(r):c=s,l(u,s.passive?s.listener:null),"function"==typeof s.listener)try{s.listener.call(this,u)}catch(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e)}else 3!==s.listenerType&&"function"==typeof s.listener.handleEvent&&s.listener.handleEvent(u);if(o(u).immediateStopped)break;s=s.next}return l(u,null),o(u).eventPhase=0,o(u).currentTarget=null,!u.defaultPrevented}},Object.defineProperty(p.prototype,"constructor",{value:p,configurable:!0,writable:!0}),t.defineEventAttribute=d,t.EventTarget=p,t.default=p,e.exports=p,e.exports.EventTarget=e.exports.default=p,e.exports.defineEventAttribute=d},8113:(e,t,r)=>{/*!
 * humanize-ms - index.js
 * Copyright(c) 2014 dead_horse <dead_horse@qq.com>
 * MIT Licensed
 */var n=r(3837),o=r(7553);e.exports=function(e){if("number"==typeof e)return e;var t=o(e);return void 0===t&&console.warn(Error(n.format("humanize-ms(%j) result undefined",e)).stack),t}},7553:e=>{function t(e,t,r,n){return Math.round(e/r)+" "+n+(t>=1.5*r?"s":"")}e.exports=function(e,r){r=r||{};var n,o,s=typeof e;if("string"===s&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return 864e5*r;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}(e);if("number"===s&&isFinite(e))return r.long?(n=Math.abs(e))>=864e5?t(e,n,864e5,"day"):n>=36e5?t(e,n,36e5,"hour"):n>=6e4?t(e,n,6e4,"minute"):n>=1e3?t(e,n,1e3,"second"):e+" ms":(o=Math.abs(e))>=864e5?Math.round(e/864e5)+"d":o>=36e5?Math.round(e/36e5)+"h":o>=6e4?Math.round(e/6e4)+"m":o>=1e3?Math.round(e/1e3)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},4512:(e,t,r)=>{r.d(t,{t:()=>ro});/**
 * @license
 * web-streams-polyfill v4.0.0-beta.3
 * Copyright 2021 Mattias Buelens, Diwank Singh Tomer and other contributors.
 * This code is released under the MIT license.
 * SPDX-License-Identifier: MIT
 */let n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol:e=>`Symbol(${e})`;function o(){}function s(e){return"object"==typeof e&&null!==e||"function"==typeof e}function i(e,t){try{Object.defineProperty(e,"name",{value:t,configurable:!0})}catch(e){}}let a=Promise,l=Promise.prototype.then,u=Promise.resolve.bind(a),c=Promise.reject.bind(a);function h(e){return new a(e)}function d(e,t,r){return l.call(e,t,r)}function f(e,t,r){d(d(e,t,r),void 0,o)}function p(e){d(e,void 0,o)}let m=e=>{if("function"==typeof queueMicrotask)m=queueMicrotask;else{let e=u(void 0);m=t=>d(e,t)}return m(e)};function y(e,t,r){if("function"!=typeof e)throw TypeError("Argument is not a function");return Function.prototype.apply.call(e,t,r)}function b(e,t,r){try{var n;return n=y(e,t,r),u(n)}catch(e){return c(e)}}class g{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(e){let t=this._back,r=t;16383===t._elements.length&&(r={_elements:[],_next:void 0}),t._elements.push(e),r!==t&&(this._back=r,t._next=r),++this._size}shift(){let e=this._front,t=e,r=this._cursor,n=r+1,o=e._elements,s=o[r];return 16384===n&&(t=e._next,n=0),--this._size,this._cursor=n,e!==t&&(this._front=t),o[r]=void 0,s}forEach(e){let t=this._cursor,r=this._front,n=r._elements;for(;!(t===n.length&&void 0===r._next||t===n.length&&(n=(r=r._next)._elements,t=0,0===n.length));)e(n[t]),++t}peek(){let e=this._front,t=this._cursor;return e._elements[t]}}let _=n("[[AbortSteps]]"),w=n("[[ErrorSteps]]"),v=n("[[CancelSteps]]"),S=n("[[PullSteps]]"),T=n("[[ReleaseSteps]]");function E(e,t){var r;e._ownerReadableStream=t,t._reader=e,"readable"===t._state?A(e):"closed"===t._state?(A(e),P(e)):(r=t._storedError,A(e),C(e,r))}function x(e,t){return tk(e._ownerReadableStream,t)}function k(e){var t;let r=e._ownerReadableStream;"readable"===r._state?C(e,TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):(t=TypeError("Reader was released and can no longer be used to monitor the stream's closedness"),A(e),C(e,t)),r._readableStreamController[T](),r._reader=void 0,e._ownerReadableStream=void 0}function R(e){return TypeError("Cannot "+e+" a stream using a released reader")}function A(e){e._closedPromise=h((t,r)=>{e._closedPromise_resolve=t,e._closedPromise_reject=r})}function C(e,t){void 0!==e._closedPromise_reject&&(p(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function P(e){void 0!==e._closedPromise_resolve&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}let O=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},q=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function j(e,t){var r;if(void 0!==e&&"object"!=typeof(r=e)&&"function"!=typeof r)throw TypeError(`${t} is not an object.`)}function $(e,t){if("function"!=typeof e)throw TypeError(`${t} is not a function.`)}function I(e,t){if(!("object"==typeof e&&null!==e||"function"==typeof e))throw TypeError(`${t} is not an object.`)}function L(e,t,r){if(void 0===e)throw TypeError(`Parameter ${t} is required in '${r}'.`)}function M(e,t,r){if(void 0===e)throw TypeError(`${t} is required in '${r}'.`)}function B(e){return Number(e)}function W(e,t){var r,n;let o=Number.MAX_SAFE_INTEGER,s=Number(e);if(!O(s=0===(r=s)?0:r))throw TypeError(`${t} is not a finite number`);if((s=0===(n=q(s))?0:n)<0||s>o)throw TypeError(`${t} is outside the accepted range of 0 to ${o}, inclusive`);return O(s)&&0!==s?s:0}function F(e){if(!s(e)||"function"!=typeof e.getReader)return!1;try{return"boolean"==typeof e.locked}catch(e){return!1}}function z(e){if(!s(e)||"function"!=typeof e.getWriter)return!1;try{return"boolean"==typeof e.locked}catch(e){return!1}}function N(e,t){if(!tE(e))throw TypeError(`${t} is not a ReadableStream.`)}function D(e,t){e._reader._readRequests.push(t)}function U(e,t,r){let n=e._reader._readRequests.shift();r?n._closeSteps():n._chunkSteps(t)}function H(e){return e._reader._readRequests.length}function V(e){let t=e._reader;return void 0!==t&&!!X(t)}class J{constructor(e){if(L(e,1,"ReadableStreamDefaultReader"),N(e,"First parameter"),tx(e))throw TypeError("This stream has already been locked for exclusive reading by another reader");E(this,e),this._readRequests=new g}get closed(){return X(this)?this._closedPromise:c(Q("closed"))}cancel(e){return X(this)?void 0===this._ownerReadableStream?c(R("cancel")):x(this,e):c(Q("cancel"))}read(){let e,t;if(!X(this))return c(Q("read"));if(void 0===this._ownerReadableStream)return c(R("read from"));let r=h((r,n)=>{e=r,t=n});return function(e,t){let r=e._ownerReadableStream;r._disturbed=!0,"closed"===r._state?t._closeSteps():"errored"===r._state?t._errorSteps(r._storedError):r._readableStreamController[S](t)}(this,{_chunkSteps:t=>e({value:t,done:!1}),_closeSteps:()=>e({value:void 0,done:!0}),_errorSteps:e=>t(e)}),r}releaseLock(){if(!X(this))throw Q("releaseLock");void 0!==this._ownerReadableStream&&(k(this),K(this,TypeError("Reader was released")))}}function X(e){return!!s(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readRequests")&&e instanceof J}function K(e,t){let r=e._readRequests;e._readRequests=new g,r.forEach(e=>{e._errorSteps(t)})}function Q(e){return TypeError(`ReadableStreamDefaultReader.prototype.${e} can only be used on a ReadableStreamDefaultReader`)}Object.defineProperties(J.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),i(J.prototype.cancel,"cancel"),i(J.prototype.read,"read"),i(J.prototype.releaseLock,"releaseLock"),"symbol"==typeof n.toStringTag&&Object.defineProperty(J.prototype,n.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});class Y{constructor(e,t){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=e,this._preventCancel=t}next(){let e=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?d(this._ongoingPromise,e,e):e(),this._ongoingPromise}return(e){let t=()=>this._returnSteps(e);return this._ongoingPromise?d(this._ongoingPromise,t,t):t()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let e=this._reader;return void 0===e?c(R("iterate")):d(e.read(),e=>{var t;return this._ongoingPromise=void 0,e.done&&(this._isFinished=!0,null===(t=this._reader)||void 0===t||t.releaseLock(),this._reader=void 0),e},e=>{var t;throw this._ongoingPromise=void 0,this._isFinished=!0,null===(t=this._reader)||void 0===t||t.releaseLock(),this._reader=void 0,e})}_returnSteps(e){if(this._isFinished)return Promise.resolve({value:e,done:!0});this._isFinished=!0;let t=this._reader;if(void 0===t)return c(R("finish iterating"));if(this._reader=void 0,!this._preventCancel){let r=t.cancel(e);return t.releaseLock(),d(r,()=>({value:e,done:!0}),void 0)}return t.releaseLock(),u({value:e,done:!0})}}let G={next(){return Z(this)?this._asyncIteratorImpl.next():c(ee("next"))},return(e){return Z(this)?this._asyncIteratorImpl.return(e):c(ee("return"))}};function Z(e){if(!s(e)||!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof Y}catch(e){return!1}}function ee(e){return TypeError(`ReadableStreamAsyncIterator.${e} can only be used on a ReadableSteamAsyncIterator`)}"symbol"==typeof n.asyncIterator&&Object.defineProperty(G,n.asyncIterator,{value(){return this},writable:!0,configurable:!0});let et=Number.isNaN||function(e){return e!=e};function er(e,t,r,n,o){new Uint8Array(e).set(new Uint8Array(r,n,o),t)}function en(e){let t=function(e,t,r){if(e.slice)return e.slice(t,r);let n=r-t,o=new ArrayBuffer(n);return er(o,0,e,t,n),o}(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(t)}function eo(e){let t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function es(e,t,r){if("number"!=typeof r||et(r)||r<0||r===1/0)throw RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:t,size:r}),e._queueTotalSize+=r}function ei(e){e._queue=new g,e._queueTotalSize=0}class ea{constructor(){throw TypeError("Illegal constructor")}get view(){if(!ec(this))throw eC("view");return this._view}respond(e){if(!ec(this))throw eC("respond");if(L(e,1,"respond"),e=W(e,"First parameter"),void 0===this._associatedReadableByteStreamController)throw TypeError("This BYOB request has been invalidated");this._view.buffer,function(e,t){let r=e._pendingPullIntos.peek();if("closed"===e._controlledReadableByteStream._state){if(0!==t)throw TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(0===t)throw TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(r.bytesFilled+t>r.byteLength)throw RangeError("bytesWritten out of range")}r.buffer=r.buffer,eT(e,t)}(this._associatedReadableByteStreamController,e)}respondWithNewView(e){if(!ec(this))throw eC("respondWithNewView");if(L(e,1,"respondWithNewView"),!ArrayBuffer.isView(e))throw TypeError("You can only respond with array buffer views");if(void 0===this._associatedReadableByteStreamController)throw TypeError("This BYOB request has been invalidated");e.buffer,function(e,t){let r=e._pendingPullIntos.peek();if("closed"===e._controlledReadableByteStream._state){if(0!==t.byteLength)throw TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(0===t.byteLength)throw TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(r.byteOffset+r.bytesFilled!==t.byteOffset)throw RangeError("The region specified by view does not match byobRequest");if(r.bufferByteLength!==t.buffer.byteLength)throw RangeError("The buffer of view has different capacity than byobRequest");if(r.bytesFilled+t.byteLength>r.byteLength)throw RangeError("The region specified by view is larger than byobRequest");let n=t.byteLength;r.buffer=t.buffer,eT(e,n)}(this._associatedReadableByteStreamController,e)}}Object.defineProperties(ea.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),i(ea.prototype.respond,"respond"),i(ea.prototype.respondWithNewView,"respondWithNewView"),"symbol"==typeof n.toStringTag&&Object.defineProperty(ea.prototype,n.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class el{constructor(){throw TypeError("Illegal constructor")}get byobRequest(){if(!eu(this))throw eP("byobRequest");return function(e){if(null===e._byobRequest&&e._pendingPullIntos.length>0){let t=e._pendingPullIntos.peek(),r=new Uint8Array(t.buffer,t.byteOffset+t.bytesFilled,t.byteLength-t.bytesFilled),n=Object.create(ea.prototype);n._associatedReadableByteStreamController=e,n._view=r,e._byobRequest=n}return e._byobRequest}(this)}get desiredSize(){if(!eu(this))throw eP("desiredSize");return eA(this)}close(){if(!eu(this))throw eP("close");if(this._closeRequested)throw TypeError("The stream has already been closed; do not close it again!");let e=this._controlledReadableByteStream._state;if("readable"!==e)throw TypeError(`The stream (in ${e} state) is not in the readable state and cannot be closed`);!function(e){let t=e._controlledReadableByteStream;if(!e._closeRequested&&"readable"===t._state){if(e._queueTotalSize>0)return void(e._closeRequested=!0);if(e._pendingPullIntos.length>0&&e._pendingPullIntos.peek().bytesFilled>0){let t=TypeError("Insufficient bytes to fill elements in the given buffer");throw ek(e,t),t}ex(e),tR(t)}}(this)}enqueue(e){if(!eu(this))throw eP("enqueue");if(L(e,1,"enqueue"),!ArrayBuffer.isView(e))throw TypeError("chunk must be an array buffer view");if(0===e.byteLength)throw TypeError("chunk must have non-zero byteLength");if(0===e.buffer.byteLength)throw TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw TypeError("stream is closed or draining");let t=this._controlledReadableByteStream._state;if("readable"!==t)throw TypeError(`The stream (in ${t} state) is not in the readable state and cannot be enqueued to`);!function(e,t){let r=e._controlledReadableByteStream;if(e._closeRequested||"readable"!==r._state)return;let n=t.buffer,o=t.byteOffset,s=t.byteLength;if(e._pendingPullIntos.length>0){let t=e._pendingPullIntos.peek();t.buffer,ev(e),t.buffer=t.buffer,"none"===t.readerType&&eb(e,t)}V(r)?(function(e){let t=e._controlledReadableByteStream._reader;for(;t._readRequests.length>0;){if(0===e._queueTotalSize)return;eR(e,t._readRequests.shift())}}(e),0===H(r))?em(e,n,o,s):(e._pendingPullIntos.length>0&&eE(e),U(r,new Uint8Array(n,o,s),!1)):ej(r)?(em(e,n,o,s),eS(e)):em(e,n,o,s),eh(e)}(this,e)}error(e){if(!eu(this))throw eP("error");ek(this,e)}[v](e){ed(this),ei(this);let t=this._cancelAlgorithm(e);return ex(this),t}[S](e){let t=this._controlledReadableByteStream;if(this._queueTotalSize>0)return void eR(this,e);let r=this._autoAllocateChunkSize;if(void 0!==r){let t;try{t=new ArrayBuffer(r)}catch(t){return void e._errorSteps(t)}let n={buffer:t,bufferByteLength:r,byteOffset:0,byteLength:r,bytesFilled:0,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(n)}D(t,e),eh(this)}[T](){if(this._pendingPullIntos.length>0){let e=this._pendingPullIntos.peek();e.readerType="none",this._pendingPullIntos=new g,this._pendingPullIntos.push(e)}}}function eu(e){return!!s(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")&&e instanceof el}function ec(e){return!!s(e)&&!!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")&&e instanceof ea}function eh(e){if(function(e){let t=e._controlledReadableByteStream;return"readable"===t._state&&!e._closeRequested&&!!e._started&&!!(V(t)&&H(t)>0||ej(t)&&eq(t)>0||eA(e)>0)}(e)){if(e._pulling)return void(e._pullAgain=!0);e._pulling=!0,f(e._pullAlgorithm(),()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,eh(e)),null),t=>(ek(e,t),null))}}function ed(e){ev(e),e._pendingPullIntos=new g}function ef(e,t){let r=!1;"closed"===e._state&&(r=!0);let n=ep(t);"default"===t.readerType?U(e,n,r):function(e,t,r){let n=e._reader._readIntoRequests.shift();r?n._closeSteps(t):n._chunkSteps(t)}(e,n,r)}function ep(e){let t=e.bytesFilled,r=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,t/r)}function em(e,t,r,n){e._queue.push({buffer:t,byteOffset:r,byteLength:n}),e._queueTotalSize+=n}function ey(e,t,r,n){let o;try{o=t.slice(r,r+n)}catch(t){throw ek(e,t),t}em(e,o,0,n)}function eb(e,t){t.bytesFilled>0&&ey(e,t.buffer,t.byteOffset,t.bytesFilled),eE(e)}function eg(e,t){let r=t.elementSize,n=t.bytesFilled-t.bytesFilled%r,o=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),s=t.bytesFilled+o,i=s-s%r,a=o,l=!1;i>n&&(a=i-t.bytesFilled,l=!0);let u=e._queue;for(;a>0;){let r=u.peek(),n=Math.min(a,r.byteLength),o=t.byteOffset+t.bytesFilled;er(t.buffer,o,r.buffer,r.byteOffset,n),r.byteLength===n?u.shift():(r.byteOffset+=n,r.byteLength-=n),e._queueTotalSize-=n,e_(e,n,t),a-=n}return l}function e_(e,t,r){r.bytesFilled+=t}function ew(e){0===e._queueTotalSize&&e._closeRequested?(ex(e),tR(e._controlledReadableByteStream)):eh(e)}function ev(e){null!==e._byobRequest&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function eS(e){for(;e._pendingPullIntos.length>0;){if(0===e._queueTotalSize)return;let t=e._pendingPullIntos.peek();eg(e,t)&&(eE(e),ef(e._controlledReadableByteStream,t))}}function eT(e,t){let r=e._pendingPullIntos.peek();ev(e),"closed"===e._controlledReadableByteStream._state?function(e,t){"none"===t.readerType&&eE(e);let r=e._controlledReadableByteStream;if(ej(r))for(;eq(r)>0;)ef(r,eE(e))}(e,r):function(e,t,r){if(e_(0,t,r),"none"===r.readerType)return eb(e,r),void eS(e);if(r.bytesFilled<r.elementSize)return;eE(e);let n=r.bytesFilled%r.elementSize;if(n>0){let t=r.byteOffset+r.bytesFilled;ey(e,r.buffer,t-n,n)}r.bytesFilled-=n,ef(e._controlledReadableByteStream,r),eS(e)}(e,t,r),eh(e)}function eE(e){return e._pendingPullIntos.shift()}function ex(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function ek(e,t){let r=e._controlledReadableByteStream;"readable"===r._state&&(ed(e),ei(e),ex(e),tA(r,t))}function eR(e,t){let r=e._queue.shift();e._queueTotalSize-=r.byteLength,ew(e);let n=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);t._chunkSteps(n)}function eA(e){let t=e._controlledReadableByteStream._state;return"errored"===t?null:"closed"===t?0:e._strategyHWM-e._queueTotalSize}function eC(e){return TypeError(`ReadableStreamBYOBRequest.prototype.${e} can only be used on a ReadableStreamBYOBRequest`)}function eP(e){return TypeError(`ReadableByteStreamController.prototype.${e} can only be used on a ReadableByteStreamController`)}function eO(e,t){e._reader._readIntoRequests.push(t)}function eq(e){return e._reader._readIntoRequests.length}function ej(e){let t=e._reader;return void 0!==t&&!!eI(t)}Object.defineProperties(el.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),i(el.prototype.close,"close"),i(el.prototype.enqueue,"enqueue"),i(el.prototype.error,"error"),"symbol"==typeof n.toStringTag&&Object.defineProperty(el.prototype,n.toStringTag,{value:"ReadableByteStreamController",configurable:!0});class e${constructor(e){if(L(e,1,"ReadableStreamBYOBReader"),N(e,"First parameter"),tx(e))throw TypeError("This stream has already been locked for exclusive reading by another reader");if(!eu(e._readableStreamController))throw TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");E(this,e),this._readIntoRequests=new g}get closed(){return eI(this)?this._closedPromise:c(eM("closed"))}cancel(e){return eI(this)?void 0===this._ownerReadableStream?c(R("cancel")):x(this,e):c(eM("cancel"))}read(e){let t,r;if(!eI(this))return c(eM("read"));if(!ArrayBuffer.isView(e))return c(TypeError("view must be an array buffer view"));if(0===e.byteLength)return c(TypeError("view must have non-zero byteLength"));if(0===e.buffer.byteLength)return c(TypeError("view's buffer must have non-zero byteLength"));if(e.buffer,void 0===this._ownerReadableStream)return c(R("read from"));let n=h((e,n)=>{t=e,r=n});return function(e,t,r){let n=e._ownerReadableStream;n._disturbed=!0,"errored"===n._state?r._errorSteps(n._storedError):function(e,t,r){let n=e._controlledReadableByteStream,o=1;t.constructor!==DataView&&(o=t.constructor.BYTES_PER_ELEMENT);let s=t.constructor,i=t.buffer,a={buffer:i,bufferByteLength:i.byteLength,byteOffset:t.byteOffset,byteLength:t.byteLength,bytesFilled:0,elementSize:o,viewConstructor:s,readerType:"byob"};if(e._pendingPullIntos.length>0)return e._pendingPullIntos.push(a),void eO(n,r);if("closed"!==n._state){if(e._queueTotalSize>0){if(eg(e,a)){let t=ep(a);return ew(e),void r._chunkSteps(t)}if(e._closeRequested){let t=TypeError("Insufficient bytes to fill elements in the given buffer");return ek(e,t),void r._errorSteps(t)}}e._pendingPullIntos.push(a),eO(n,r),eh(e)}else{let e=new s(a.buffer,a.byteOffset,0);r._closeSteps(e)}}(n._readableStreamController,t,r)}(this,e,{_chunkSteps:e=>t({value:e,done:!1}),_closeSteps:e=>t({value:e,done:!0}),_errorSteps:e=>r(e)}),n}releaseLock(){if(!eI(this))throw eM("releaseLock");void 0!==this._ownerReadableStream&&(k(this),eL(this,TypeError("Reader was released")))}}function eI(e){return!!s(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")&&e instanceof e$}function eL(e,t){let r=e._readIntoRequests;e._readIntoRequests=new g,r.forEach(e=>{e._errorSteps(t)})}function eM(e){return TypeError(`ReadableStreamBYOBReader.prototype.${e} can only be used on a ReadableStreamBYOBReader`)}function eB(e,t){let{highWaterMark:r}=e;if(void 0===r)return t;if(et(r)||r<0)throw RangeError("Invalid highWaterMark");return r}function eW(e){let{size:t}=e;return t||(()=>1)}function eF(e,t){j(e,t);let r=null==e?void 0:e.highWaterMark,n=null==e?void 0:e.size;return{highWaterMark:void 0===r?void 0:B(r),size:void 0===n?void 0:($(n,`${t} has member 'size' that`),e=>B(n(e)))}}Object.defineProperties(e$.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),i(e$.prototype.cancel,"cancel"),i(e$.prototype.read,"read"),i(e$.prototype.releaseLock,"releaseLock"),"symbol"==typeof n.toStringTag&&Object.defineProperty(e$.prototype,n.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});let ez="function"==typeof AbortController;class eN{constructor(e={},t={}){void 0===e?e=null:I(e,"First parameter");let r=eF(t,"Second parameter"),n=function(e,t){j(e,t);let r=null==e?void 0:e.abort,n=null==e?void 0:e.close,o=null==e?void 0:e.start,s=null==e?void 0:e.type,i=null==e?void 0:e.write;return{abort:void 0===r?void 0:($(r,`${t} has member 'abort' that`),t=>b(r,e,[t])),close:void 0===n?void 0:($(n,`${t} has member 'close' that`),()=>b(n,e,[])),start:void 0===o?void 0:($(o,`${t} has member 'start' that`),t=>y(o,e,[t])),write:void 0===i?void 0:($(i,`${t} has member 'write' that`),(t,r)=>b(i,e,[t,r])),type:s}}(e,"First parameter");if(this._state="writable",this._storedError=void 0,this._writer=void 0,this._writableStreamController=void 0,this._writeRequests=new g,this._inFlightWriteRequest=void 0,this._closeRequest=void 0,this._inFlightCloseRequest=void 0,this._pendingAbortRequest=void 0,this._backpressure=!1,void 0!==n.type)throw RangeError("Invalid type is specified");let o=eW(r);!function(e,t,r,n){let o,s,i,a;let l=Object.create(e3.prototype);o=void 0!==t.start?()=>t.start(l):()=>{},s=void 0!==t.write?e=>t.write(e,l):()=>u(void 0),i=void 0!==t.close?()=>t.close():()=>u(void 0),a=void 0!==t.abort?e=>t.abort(e):()=>u(void 0),l._controlledWritableStream=e,e._writableStreamController=l,l._queue=void 0,l._queueTotalSize=void 0,ei(l),l._abortReason=void 0,l._abortController=function(){if(ez)return new AbortController}(),l._started=!1,l._strategySizeAlgorithm=n,l._strategyHWM=r,l._writeAlgorithm=s,l._closeAlgorithm=i,l._abortAlgorithm=a,eG(e,0>=e5(l)),f(u(o()),()=>(l._started=!0,e4(l),null),t=>(l._started=!0,eJ(e,t),null))}(this,n,eB(r,1),o)}get locked(){if(!eD(this))throw te("locked");return eU(this)}abort(e){return eD(this)?eU(this)?c(TypeError("Cannot abort a stream that already has a writer")):eH(this,e):c(te("abort"))}close(){return eD(this)?eU(this)?c(TypeError("Cannot close a stream that already has a writer")):eQ(this)?c(TypeError("Cannot close an already-closing stream")):eV(this):c(te("close"))}getWriter(){if(!eD(this))throw te("getWriter");return new eZ(this)}}function eD(e){return!!s(e)&&!!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")&&e instanceof eN}function eU(e){return void 0!==e._writer}function eH(e,t){var r;if("closed"===e._state||"errored"===e._state)return u(void 0);e._writableStreamController._abortReason=t,null===(r=e._writableStreamController._abortController)||void 0===r||r.abort(t);let n=e._state;if("closed"===n||"errored"===n)return u(void 0);if(void 0!==e._pendingAbortRequest)return e._pendingAbortRequest._promise;let o=!1;"erroring"===n&&(o=!0,t=void 0);let s=h((r,n)=>{e._pendingAbortRequest={_promise:void 0,_resolve:r,_reject:n,_reason:t,_wasAlreadyErroring:o}});return e._pendingAbortRequest._promise=s,o||eX(e,t),s}function eV(e){var t;let r=e._state;if("closed"===r||"errored"===r)return c(TypeError(`The stream (in ${r} state) is not in the writable state and cannot be closed`));let n=h((t,r)=>{e._closeRequest={_resolve:t,_reject:r}}),o=e._writer;return void 0!==o&&e._backpressure&&"writable"===r&&tc(o),es(t=e._writableStreamController,e2,0),e4(t),n}function eJ(e,t){"writable"!==e._state?eK(e):eX(e,t)}function eX(e,t){let r=e._writableStreamController;e._state="erroring",e._storedError=t;let n=e._writer;void 0!==n&&e1(n,t),!(void 0!==e._inFlightWriteRequest||void 0!==e._inFlightCloseRequest)&&r._started&&eK(e)}function eK(e){e._state="errored",e._writableStreamController[w]();let t=e._storedError;if(e._writeRequests.forEach(e=>{e._reject(t)}),e._writeRequests=new g,void 0===e._pendingAbortRequest)return void eY(e);let r=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,r._wasAlreadyErroring)return r._reject(t),void eY(e);f(e._writableStreamController[_](r._reason),()=>(r._resolve(),eY(e),null),t=>(r._reject(t),eY(e),null))}function eQ(e){return void 0!==e._closeRequest||void 0!==e._inFlightCloseRequest}function eY(e){void 0!==e._closeRequest&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);let t=e._writer;void 0!==t&&ts(t,e._storedError)}function eG(e,t){let r=e._writer;void 0!==r&&t!==e._backpressure&&(t?ta(r):tc(r)),e._backpressure=t}Object.defineProperties(eN.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),i(eN.prototype.abort,"abort"),i(eN.prototype.close,"close"),i(eN.prototype.getWriter,"getWriter"),"symbol"==typeof n.toStringTag&&Object.defineProperty(eN.prototype,n.toStringTag,{value:"WritableStream",configurable:!0});class eZ{constructor(e){if(L(e,1,"WritableStreamDefaultWriter"),function(e,t){if(!eD(e))throw TypeError(`${t} is not a WritableStream.`)}(e,"First parameter"),eU(e))throw TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=e,e._writer=this;let t=e._state;if("writable"===t)!eQ(e)&&e._backpressure?ta(this):function(e){ta(e),tc(e)}(this),to(this);else if("erroring"===t)tl(this,e._storedError),to(this);else if("closed"===t)(function(e){ta(e),tc(e)})(this),to(this),ti(this);else{let t=e._storedError;tl(this,t),function(e,t){to(e),ts(e,t)}(this,t)}}get closed(){return e0(this)?this._closedPromise:c(tr("closed"))}get desiredSize(){if(!e0(this))throw tr("desiredSize");if(void 0===this._ownerWritableStream)throw tn("desiredSize");return function(e){let t=e._ownerWritableStream,r=t._state;return"errored"===r||"erroring"===r?null:"closed"===r?0:e5(t._writableStreamController)}(this)}get ready(){return e0(this)?this._readyPromise:c(tr("ready"))}abort(e){return e0(this)?void 0===this._ownerWritableStream?c(tn("abort")):eH(this._ownerWritableStream,e):c(tr("abort"))}close(){if(!e0(this))return c(tr("close"));let e=this._ownerWritableStream;return void 0===e?c(tn("close")):eQ(e)?c(TypeError("Cannot close an already-closing stream")):eV(this._ownerWritableStream)}releaseLock(){if(!e0(this))throw tr("releaseLock");void 0!==this._ownerWritableStream&&function(e){let t=e._ownerWritableStream,r=TypeError("Writer was released and can no longer be used to monitor the stream's closedness");e1(e,r),"pending"===e._closedPromiseState||to(e),ts(e,r),t._writer=void 0,e._ownerWritableStream=void 0}(this)}write(e){return e0(this)?void 0===this._ownerWritableStream?c(tn("write to")):function(e,t){let r=e._ownerWritableStream,n=r._writableStreamController,o=function(e,t){try{return e._strategySizeAlgorithm(t)}catch(t){return e7(e,t),1}}(n,t);if(r!==e._ownerWritableStream)return c(tn("write to"));let s=r._state;if("errored"===s)return c(r._storedError);if(eQ(r)||"closed"===s)return c(TypeError("The stream is closing or closed and cannot be written to"));if("erroring"===s)return c(r._storedError);let i=h((e,t)=>{r._writeRequests.push({_resolve:e,_reject:t})});return function(e,t,r){try{es(e,t,r)}catch(t){return void e7(e,t)}let n=e._controlledWritableStream;eQ(n)||"writable"!==n._state||eG(n,0>=e5(e)),e4(e)}(n,t,o),i}(this,e):c(tr("write"))}}function e0(e){return!!s(e)&&!!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")&&e instanceof eZ}function e1(e,t){"pending"===e._readyPromiseState?tu(e,t):tl(e,t)}Object.defineProperties(eZ.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),i(eZ.prototype.abort,"abort"),i(eZ.prototype.close,"close"),i(eZ.prototype.releaseLock,"releaseLock"),i(eZ.prototype.write,"write"),"symbol"==typeof n.toStringTag&&Object.defineProperty(eZ.prototype,n.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});let e2={};class e3{constructor(){throw TypeError("Illegal constructor")}get abortReason(){if(!e8(this))throw tt("abortReason");return this._abortReason}get signal(){if(!e8(this))throw tt("signal");if(void 0===this._abortController)throw TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(e){if(!e8(this))throw tt("error");"writable"===this._controlledWritableStream._state&&e9(this,e)}[_](e){let t=this._abortAlgorithm(e);return e6(this),t}[w](){ei(this)}}function e8(e){return!!s(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")&&e instanceof e3}function e6(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function e5(e){return e._strategyHWM-e._queueTotalSize}function e4(e){let t=e._controlledWritableStream;if(!e._started||void 0!==t._inFlightWriteRequest)return;if("erroring"===t._state)return void eK(t);if(0===e._queue.length)return;let r=e._queue.peek().value;r===e2?function(e){let t=e._controlledWritableStream;t._inFlightCloseRequest=t._closeRequest,t._closeRequest=void 0,eo(e);let r=e._closeAlgorithm();e6(e),f(r,()=>((function(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,"erroring"===e._state&&(e._storedError=void 0,void 0!==e._pendingAbortRequest&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";let t=e._writer;void 0!==t&&ti(t)})(t),null),e=>(t._inFlightCloseRequest._reject(e),t._inFlightCloseRequest=void 0,void 0!==t._pendingAbortRequest&&(t._pendingAbortRequest._reject(e),t._pendingAbortRequest=void 0),eJ(t,e),null))}(e):function(e,t){let r=e._controlledWritableStream;r._inFlightWriteRequest=r._writeRequests.shift(),f(e._writeAlgorithm(t),()=>{r._inFlightWriteRequest._resolve(void 0),r._inFlightWriteRequest=void 0;let t=r._state;return eo(e),eQ(r)||"writable"!==t||eG(r,0>=e5(e)),e4(e),null},t=>("writable"===r._state&&e6(e),r._inFlightWriteRequest._reject(t),r._inFlightWriteRequest=void 0,eJ(r,t),null))}(e,r)}function e7(e,t){"writable"===e._controlledWritableStream._state&&e9(e,t)}function e9(e,t){let r=e._controlledWritableStream;e6(e),eX(r,t)}function te(e){return TypeError(`WritableStream.prototype.${e} can only be used on a WritableStream`)}function tt(e){return TypeError(`WritableStreamDefaultController.prototype.${e} can only be used on a WritableStreamDefaultController`)}function tr(e){return TypeError(`WritableStreamDefaultWriter.prototype.${e} can only be used on a WritableStreamDefaultWriter`)}function tn(e){return TypeError("Cannot "+e+" a stream using a released writer")}function to(e){e._closedPromise=h((t,r)=>{e._closedPromise_resolve=t,e._closedPromise_reject=r,e._closedPromiseState="pending"})}function ts(e,t){void 0!==e._closedPromise_reject&&(p(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function ti(e){void 0!==e._closedPromise_resolve&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function ta(e){e._readyPromise=h((t,r)=>{e._readyPromise_resolve=t,e._readyPromise_reject=r}),e._readyPromiseState="pending"}function tl(e,t){ta(e),tu(e,t)}function tu(e,t){void 0!==e._readyPromise_reject&&(p(e._readyPromise),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function tc(e){void 0!==e._readyPromise_resolve&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}Object.defineProperties(e3.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),"symbol"==typeof n.toStringTag&&Object.defineProperty(e3.prototype,n.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});let th="undefined"!=typeof DOMException?DOMException:void 0,td=!function(e){if("function"!=typeof e&&"object"!=typeof e)return!1;try{return new e,!0}catch(e){return!1}}(th)?function(){let e=function(e,t){this.message=e||"",this.name=t||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}():th;function tf(e,t,r,n,o,s){let i=e.getReader(),a=t.getWriter();tE(e)&&(e._disturbed=!0);let l,y,b,g=!1,_=!1,w="readable",v="writable",S=!1,T=!1,E=h(e=>{b=e}),x=Promise.resolve(void 0);return h((k,R)=>{let A;function C(){if(g)return;let e=h((e,t)=>{!function r(n){n?e():d(g?u(!0):d(a.ready,()=>d(i.read(),e=>!!e.done||(p(x=a.write(e.value)),!1))),r,t)}(!1)});p(e)}function P(){return w="closed",r?$():j(()=>(eD(t)&&(S=eQ(t),v=t._state),S||"closed"===v?u(void 0):"erroring"===v||"errored"===v?c(y):(S=!0,a.close())),!1,void 0),null}function O(e){return g||(w="errored",l=e,n?$(!0,e):j(()=>a.abort(e),!0,e)),null}function q(e){return _||(v="errored",y=e,o?$(!0,e):j(()=>i.cancel(e),!0,e)),null}if(void 0!==s&&(A=()=>{let e=void 0!==s.reason?s.reason:new td("Aborted","AbortError"),t=[];n||t.push(()=>"writable"===v?a.abort(e):u(void 0)),o||t.push(()=>"readable"===w?i.cancel(e):u(void 0)),j(()=>Promise.all(t.map(e=>e())),!0,e)},s.aborted?A():s.addEventListener("abort",A)),tE(e)&&(w=e._state,l=e._storedError),eD(t)&&(v=t._state,y=t._storedError,S=eQ(t)),tE(e)&&eD(t)&&(T=!0,b()),"errored"===w)O(l);else if("erroring"===v||"errored"===v)q(y);else if("closed"===w)P();else if(S||"closed"===v){let e=TypeError("the destination writable stream closed before all data could be piped to it");o?$(!0,e):j(()=>i.cancel(e),!0,e)}function j(e,t,r){function n(){let e;return"writable"!==v||S?o():f(u(function t(){if(e!==x)return e=x,d(x,t,t)}()),o),null}function o(){return e?f(e(),()=>I(t,r),e=>I(!0,e)):I(t,r),null}g||(g=!0,T?n():f(E,n))}function $(e,t){j(void 0,e,t)}function I(e,t){return _=!0,a.releaseLock(),i.releaseLock(),void 0!==s&&s.removeEventListener("abort",A),e?R(t):k(void 0),null}g||(f(i.closed,P,O),f(a.closed,function(){return _||(v="closed"),null},q)),T?C():m(()=>{T=!0,b(),C()})})}class tp{constructor(){throw TypeError("Illegal constructor")}get desiredSize(){if(!tm(this))throw tv("desiredSize");return t_(this)}close(){if(!tm(this))throw tv("close");if(!tw(this))throw TypeError("The stream is not in a state that permits close");!function(e){if(!tw(e))return;let t=e._controlledReadableStream;e._closeRequested=!0,0===e._queue.length&&(tb(e),tR(t))}(this)}enqueue(e){if(!tm(this))throw tv("enqueue");if(!tw(this))throw TypeError("The stream is not in a state that permits enqueue");return function(e,t){if(!tw(e))return;let r=e._controlledReadableStream;if(tx(r)&&H(r)>0)U(r,t,!1);else{let r;try{r=e._strategySizeAlgorithm(t)}catch(t){throw tg(e,t),t}try{es(e,t,r)}catch(t){throw tg(e,t),t}}ty(e)}(this,e)}error(e){if(!tm(this))throw tv("error");tg(this,e)}[v](e){ei(this);let t=this._cancelAlgorithm(e);return tb(this),t}[S](e){let t=this._controlledReadableStream;if(this._queue.length>0){let r=eo(this);this._closeRequested&&0===this._queue.length?(tb(this),tR(t)):ty(this),e._chunkSteps(r)}else D(t,e),ty(this)}[T](){}}function tm(e){return!!s(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")&&e instanceof tp}function ty(e){if(function(e){let t=e._controlledReadableStream;return!!tw(e)&&!!e._started&&!!(tx(t)&&H(t)>0||t_(e)>0)}(e)){if(e._pulling)return void(e._pullAgain=!0);e._pulling=!0,f(e._pullAlgorithm(),()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,ty(e)),null),t=>(tg(e,t),null))}}function tb(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function tg(e,t){let r=e._controlledReadableStream;"readable"===r._state&&(ei(e),tb(e),tA(r,t))}function t_(e){let t=e._controlledReadableStream._state;return"errored"===t?null:"closed"===t?0:e._strategyHWM-e._queueTotalSize}function tw(e){return!e._closeRequested&&"readable"===e._controlledReadableStream._state}function tv(e){return TypeError(`ReadableStreamDefaultController.prototype.${e} can only be used on a ReadableStreamDefaultController`)}function tS(e,t){j(e,t);let r=null==e?void 0:e.preventAbort,n=null==e?void 0:e.preventCancel,o=null==e?void 0:e.preventClose,s=null==e?void 0:e.signal;return void 0!==s&&function(e,t){if(!function(e){if("object"!=typeof e||null===e)return!1;try{return"boolean"==typeof e.aborted}catch(e){return!1}}(e))throw TypeError(`${t} is not an AbortSignal.`)}(s,`${t} has member 'signal' that`),{preventAbort:!!r,preventCancel:!!n,preventClose:!!o,signal:s}}Object.defineProperties(tp.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),i(tp.prototype.close,"close"),i(tp.prototype.enqueue,"enqueue"),i(tp.prototype.error,"error"),"symbol"==typeof n.toStringTag&&Object.defineProperty(tp.prototype,n.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});class tT{constructor(e={},t={}){void 0===e?e=null:I(e,"First parameter");let r=eF(t,"Second parameter"),n=function(e,t){j(e,t);let r=null==e?void 0:e.autoAllocateChunkSize,n=null==e?void 0:e.cancel,o=null==e?void 0:e.pull,s=null==e?void 0:e.start,i=null==e?void 0:e.type;return{autoAllocateChunkSize:void 0===r?void 0:W(r,`${t} has member 'autoAllocateChunkSize' that`),cancel:void 0===n?void 0:($(n,`${t} has member 'cancel' that`),t=>b(n,e,[t])),pull:void 0===o?void 0:($(o,`${t} has member 'pull' that`),t=>b(o,e,[t])),start:void 0===s?void 0:($(s,`${t} has member 'start' that`),t=>y(s,e,[t])),type:void 0===i?void 0:function(e,t){if("bytes"!=(e=`${e}`))throw TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamType`);return e}(i,`${t} has member 'type' that`)}}(e,"First parameter");if(this._state="readable",this._reader=void 0,this._storedError=void 0,this._disturbed=!1,"bytes"===n.type){if(void 0!==r.size)throw RangeError("The strategy for a byte stream cannot have a size function");!function(e,t,r){let n,o,s;let i=Object.create(el.prototype);n=void 0!==t.start?()=>t.start(i):()=>{},o=void 0!==t.pull?()=>t.pull(i):()=>u(void 0),s=void 0!==t.cancel?e=>t.cancel(e):()=>u(void 0);let a=t.autoAllocateChunkSize;if(0===a)throw TypeError("autoAllocateChunkSize must be greater than 0");i._controlledReadableByteStream=e,i._pullAgain=!1,i._pulling=!1,i._byobRequest=null,i._queue=i._queueTotalSize=void 0,ei(i),i._closeRequested=!1,i._started=!1,i._strategyHWM=r,i._pullAlgorithm=o,i._cancelAlgorithm=s,i._autoAllocateChunkSize=a,i._pendingPullIntos=new g,e._readableStreamController=i,f(u(n()),()=>(i._started=!0,eh(i),null),e=>(ek(i,e),null))}(this,n,eB(r,0))}else{let e=eW(r);!function(e,t,r,n){let o,s,i;let a=Object.create(tp.prototype);o=void 0!==t.start?()=>t.start(a):()=>{},s=void 0!==t.pull?()=>t.pull(a):()=>u(void 0),i=void 0!==t.cancel?e=>t.cancel(e):()=>u(void 0),a._controlledReadableStream=e,a._queue=void 0,a._queueTotalSize=void 0,ei(a),a._started=!1,a._closeRequested=!1,a._pullAgain=!1,a._pulling=!1,a._strategySizeAlgorithm=n,a._strategyHWM=r,a._pullAlgorithm=s,a._cancelAlgorithm=i,e._readableStreamController=a,f(u(o()),()=>(a._started=!0,ty(a),null),e=>(tg(a,e),null))}(this,n,eB(r,1),e)}}get locked(){if(!tE(this))throw tC("locked");return tx(this)}cancel(e){return tE(this)?tx(this)?c(TypeError("Cannot cancel a stream that already has a reader")):tk(this,e):c(tC("cancel"))}getReader(e){if(!tE(this))throw tC("getReader");return void 0===function(e,t){j(e,t);let r=null==e?void 0:e.mode;return{mode:void 0===r?void 0:function(e,t){if("byob"!=(e=`${e}`))throw TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamReaderMode`);return e}(r,`${t} has member 'mode' that`)}}(e,"First parameter").mode?new J(this):new e$(this)}pipeThrough(e,t={}){if(!F(this))throw tC("pipeThrough");L(e,1,"pipeThrough");let r=function(e,t){j(e,t);let r=null==e?void 0:e.readable;M(r,"readable","ReadableWritablePair"),function(e,t){if(!F(e))throw TypeError(`${t} is not a ReadableStream.`)}(r,`${t} has member 'readable' that`);let n=null==e?void 0:e.writable;return M(n,"writable","ReadableWritablePair"),function(e,t){if(!z(e))throw TypeError(`${t} is not a WritableStream.`)}(n,`${t} has member 'writable' that`),{readable:r,writable:n}}(e,"First parameter"),n=tS(t,"Second parameter");if(this.locked)throw TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(r.writable.locked)throw TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");return p(tf(this,r.writable,n.preventClose,n.preventAbort,n.preventCancel,n.signal)),r.readable}pipeTo(e,t={}){let r;if(!F(this))return c(tC("pipeTo"));if(void 0===e)return c("Parameter 1 is required in 'pipeTo'.");if(!z(e))return c(TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));try{r=tS(t,"Second parameter")}catch(e){return c(e)}return this.locked?c(TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):e.locked?c(TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):tf(this,e,r.preventClose,r.preventAbort,r.preventCancel,r.signal)}tee(){if(!F(this))throw tC("tee");if(this.locked)throw TypeError("Cannot tee a stream that already has a reader");return!function(e){try{return e.getReader({mode:"byob"}).releaseLock(),!0}catch(e){return!1}}(this)?function(e,t){let r=e.getReader(),n,o,s,i,a,l=!1,c=!1,d=!1,p=!1,m=h(e=>{a=e});function y(){return l?c=!0:(l=!0,f(r.read(),e=>{if(c=!1,e.done)return d||s.close(),p||i.close(),d&&p||a(void 0),null;let t=e.value;return d||s.enqueue(t),p||i.enqueue(t),l=!1,c&&y(),null},()=>(l=!1,null))),u(void 0)}let b=new tT({start(e){s=e},pull:y,cancel:function(e){if(d=!0,n=e,p){let e=[n,o],t=r.cancel(e);a(t)}return m}}),g=new tT({start(e){i=e},pull:y,cancel:function(e){if(p=!0,o=e,d){let e=[n,o],t=r.cancel(e);a(t)}return m}});return f(r.closed,void 0,e=>(s.error(e),i.error(e),d&&p||a(void 0),null)),[b,g]}(this):function(e){let t,r,n,o,s,i=e.getReader(),a=!1,l=!1,c=!1,d=!1,p=!1,m=!1,y=h(e=>{s=e});function b(e){f(e.closed,void 0,t=>(e!==i||(n.error(t),o.error(t),p&&m||s(void 0)),null))}function g(){a&&(i.releaseLock(),b(i=e.getReader()),a=!1),f(i.read(),e=>{var t,r;if(c=!1,d=!1,e.done)return p||n.close(),m||o.close(),null===(t=n.byobRequest)||void 0===t||t.respond(0),null===(r=o.byobRequest)||void 0===r||r.respond(0),p&&m||s(void 0),null;let a=e.value,u=a;if(!p&&!m)try{u=en(a)}catch(e){return n.error(e),o.error(e),s(i.cancel(e)),null}return p||n.enqueue(a),m||o.enqueue(u),l=!1,c?w():d&&v(),null},()=>(l=!1,null))}function _(t,r){a||(i.releaseLock(),b(i=e.getReader({mode:"byob"})),a=!0);let u=r?o:n,h=r?n:o;f(i.read(t),e=>{var t;c=!1,d=!1;let n=r?m:p,o=r?p:m;if(e.done){n||u.close(),o||h.close();let r=e.value;return void 0!==r&&(n||u.byobRequest.respondWithNewView(r),o||null===(t=h.byobRequest)||void 0===t||t.respond(0)),n&&o||s(void 0),null}let a=e.value;if(o)n||u.byobRequest.respondWithNewView(a);else{let e;try{e=en(a)}catch(e){return u.error(e),h.error(e),s(i.cancel(e)),null}n||u.byobRequest.respondWithNewView(a),h.enqueue(e)}return l=!1,c?w():d&&v(),null},()=>(l=!1,null))}function w(){if(l)return c=!0,u(void 0);l=!0;let e=n.byobRequest;return null===e?g():_(e.view,!1),u(void 0)}function v(){if(l)return d=!0,u(void 0);l=!0;let e=o.byobRequest;return null===e?g():_(e.view,!0),u(void 0)}let S=new tT({type:"bytes",start(e){n=e},pull:w,cancel:function(e){if(p=!0,t=e,m){let e=[t,r],n=i.cancel(e);s(n)}return y}}),T=new tT({type:"bytes",start(e){o=e},pull:v,cancel:function(e){if(m=!0,r=e,p){let e=[t,r],n=i.cancel(e);s(n)}return y}});return b(i),[S,T]}(this)}values(e){if(!F(this))throw tC("values");return function(e,t){let r=new Y(e.getReader(),t),n=Object.create(G);return n._asyncIteratorImpl=r,n}(this,(j(e,"First parameter"),{preventCancel:!!(null==e?void 0:e.preventCancel)}).preventCancel)}}function tE(e){return!!s(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")&&e instanceof tT}function tx(e){return void 0!==e._reader}function tk(e,t){if(e._disturbed=!0,"closed"===e._state)return u(void 0);if("errored"===e._state)return c(e._storedError);tR(e);let r=e._reader;if(void 0!==r&&eI(r)){let e=r._readIntoRequests;r._readIntoRequests=new g,e.forEach(e=>{e._closeSteps(void 0)})}return d(e._readableStreamController[v](t),o,void 0)}function tR(e){e._state="closed";let t=e._reader;if(void 0!==t&&(P(t),X(t))){let e=t._readRequests;t._readRequests=new g,e.forEach(e=>{e._closeSteps()})}}function tA(e,t){e._state="errored",e._storedError=t;let r=e._reader;void 0!==r&&(C(r,t),X(r)?K(r,t):eL(r,t))}function tC(e){return TypeError(`ReadableStream.prototype.${e} can only be used on a ReadableStream`)}function tP(e,t){j(e,t);let r=null==e?void 0:e.highWaterMark;return M(r,"highWaterMark","QueuingStrategyInit"),{highWaterMark:B(r)}}Object.defineProperties(tT.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),i(tT.prototype.cancel,"cancel"),i(tT.prototype.getReader,"getReader"),i(tT.prototype.pipeThrough,"pipeThrough"),i(tT.prototype.pipeTo,"pipeTo"),i(tT.prototype.tee,"tee"),i(tT.prototype.values,"values"),"symbol"==typeof n.toStringTag&&Object.defineProperty(tT.prototype,n.toStringTag,{value:"ReadableStream",configurable:!0}),"symbol"==typeof n.asyncIterator&&Object.defineProperty(tT.prototype,n.asyncIterator,{value:tT.prototype.values,writable:!0,configurable:!0});let tO=e=>e.byteLength;i(tO,"size");class tq{constructor(e){L(e,1,"ByteLengthQueuingStrategy"),e=tP(e,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=e.highWaterMark}get highWaterMark(){if(!t$(this))throw tj("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!t$(this))throw tj("size");return tO}}function tj(e){return TypeError(`ByteLengthQueuingStrategy.prototype.${e} can only be used on a ByteLengthQueuingStrategy`)}function t$(e){return!!s(e)&&!!Object.prototype.hasOwnProperty.call(e,"_byteLengthQueuingStrategyHighWaterMark")&&e instanceof tq}Object.defineProperties(tq.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),"symbol"==typeof n.toStringTag&&Object.defineProperty(tq.prototype,n.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});let tI=()=>1;i(tI,"size");class tL{constructor(e){L(e,1,"CountQueuingStrategy"),e=tP(e,"First parameter"),this._countQueuingStrategyHighWaterMark=e.highWaterMark}get highWaterMark(){if(!tB(this))throw tM("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!tB(this))throw tM("size");return tI}}function tM(e){return TypeError(`CountQueuingStrategy.prototype.${e} can only be used on a CountQueuingStrategy`)}function tB(e){return!!s(e)&&!!Object.prototype.hasOwnProperty.call(e,"_countQueuingStrategyHighWaterMark")&&e instanceof tL}Object.defineProperties(tL.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),"symbol"==typeof n.toStringTag&&Object.defineProperty(tL.prototype,n.toStringTag,{value:"CountQueuingStrategy",configurable:!0});class tW{constructor(e={},t={},r={}){let n;void 0===e&&(e=null);let o=eF(t,"Second parameter"),s=eF(r,"Third parameter"),i=function(e,t){j(e,t);let r=null==e?void 0:e.flush,n=null==e?void 0:e.readableType,o=null==e?void 0:e.start,s=null==e?void 0:e.transform,i=null==e?void 0:e.writableType;return{flush:void 0===r?void 0:($(r,`${t} has member 'flush' that`),t=>b(r,e,[t])),readableType:n,start:void 0===o?void 0:($(o,`${t} has member 'start' that`),t=>y(o,e,[t])),transform:void 0===s?void 0:($(s,`${t} has member 'transform' that`),(t,r)=>b(s,e,[t,r])),writableType:i}}(e,"First parameter");if(void 0!==i.readableType)throw RangeError("Invalid readableType specified");if(void 0!==i.writableType)throw RangeError("Invalid writableType specified");let a=eB(s,0),l=eW(s),f=eB(o,1),p=eW(o);(function(e,t,r,n,o,s){function i(){return t}e._writableState="writable",e._writableStoredError=void 0,e._writableHasInFlightOperation=!1,e._writableStarted=!1,e._writable=new eN({start(r){e._writableController=r;try{let t=r.signal;void 0!==t&&t.addEventListener("abort",()=>{"writable"===e._writableState&&(e._writableState="erroring",t.reason&&(e._writableStoredError=t.reason))})}catch(e){}return d(t,()=>(e._writableStarted=!0,t8(e),null),t=>{throw e._writableStarted=!0,t1(e,t),t})},write:t=>(e._writableHasInFlightOperation=!0,d(function(e,t){let r=e._transformStreamController;return e._backpressure?d(e._backpressureChangePromise,()=>{if("erroring"===(eD(e._writable)?e._writable._state:e._writableState))throw eD(e._writable)?e._writable._storedError:e._writableStoredError;return tX(r,t)},void 0):tX(r,t)}(e,t),()=>(e._writableHasInFlightOperation=!1,t8(e),null),t=>{throw e._writableHasInFlightOperation=!1,t1(e,t),t})),close:()=>(e._writableHasInFlightOperation=!0,d(function(e){let t=e._transformStreamController,r=t._flushAlgorithm();return tV(t),d(r,()=>{if("errored"===e._readableState)throw e._readableStoredError;tY(e)&&tG(e)},t=>{throw tz(e,t),e._readableStoredError})}(e),()=>(e._writableHasInFlightOperation=!1,"erroring"===e._writableState&&(e._writableStoredError=void 0),e._writableState="closed",null),t=>{throw e._writableHasInFlightOperation=!1,e._writableState,t1(e,t),t})),abort:t=>(e._writableState="errored",e._writableStoredError=t,tz(e,t),u(void 0))},{highWaterMark:r,size:n}),e._readableState="readable",e._readableStoredError=void 0,e._readableCloseRequested=!1,e._readablePulling=!1,e._readable=new tT({start:r=>(e._readableController=r,t.catch(t=>{tZ(e,t)})),pull:()=>(e._readablePulling=!0,(tD(e,!1),e._backpressureChangePromise).catch(t=>{tZ(e,t)})),cancel:t=>(e._readableState="closed",tN(e,t),u(void 0))},{highWaterMark:o,size:s}),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,tD(e,!0),e._transformStreamController=void 0})(this,h(e=>{n=e}),f,p,a,l),function(e,t){let r,n;let o=Object.create(tU.prototype);r=void 0!==t.transform?e=>t.transform(e,o):e=>{try{return tJ(o,e),u(void 0)}catch(e){return c(e)}},n=void 0!==t.flush?()=>t.flush(o):()=>u(void 0),o._controlledTransformStream=e,e._transformStreamController=o,o._transformAlgorithm=r,o._flushAlgorithm=n}(this,i),void 0!==i.start?n(i.start(this._transformStreamController)):n(void 0)}get readable(){if(!tF(this))throw tQ("readable");return this._readable}get writable(){if(!tF(this))throw tQ("writable");return this._writable}}function tF(e){return!!s(e)&&!!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")&&e instanceof tW}function tz(e,t){tZ(e,t),tN(e,t)}function tN(e,t){tV(e._transformStreamController),e._writableController.error(t),"writable"===e._writableState&&t2(e,t),e._backpressure&&tD(e,!1)}function tD(e,t){void 0!==e._backpressureChangePromise&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=h(t=>{e._backpressureChangePromise_resolve=t}),e._backpressure=t}Object.defineProperties(tW.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),"symbol"==typeof n.toStringTag&&Object.defineProperty(tW.prototype,n.toStringTag,{value:"TransformStream",configurable:!0});class tU{constructor(){throw TypeError("Illegal constructor")}get desiredSize(){if(!tH(this))throw tK("desiredSize");return t0(this._controlledTransformStream)}enqueue(e){if(!tH(this))throw tK("enqueue");tJ(this,e)}error(e){if(!tH(this))throw tK("error");tz(this._controlledTransformStream,e)}terminate(){if(!tH(this))throw tK("terminate");!function(e){let t=e._controlledTransformStream;tY(t)&&tG(t),tN(t,TypeError("TransformStream terminated"))}(this)}}function tH(e){return!!s(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")&&e instanceof tU}function tV(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0}function tJ(e,t){let r=e._controlledTransformStream;if(!tY(r))throw TypeError("Readable side is not in a state that permits enqueue");try{!function(e,t){e._readablePulling=!1;try{e._readableController.enqueue(t)}catch(t){throw tZ(e,t),t}}(r,t)}catch(e){throw tN(r,e),r._readableStoredError}!(tY(r)&&(r._readablePulling||t0(r)>0))!==r._backpressure&&tD(r,!0)}function tX(e,t){return d(e._transformAlgorithm(t),void 0,t=>{throw tz(e._controlledTransformStream,t),t})}function tK(e){return TypeError(`TransformStreamDefaultController.prototype.${e} can only be used on a TransformStreamDefaultController`)}function tQ(e){return TypeError(`TransformStream.prototype.${e} can only be used on a TransformStream`)}function tY(e){return!e._readableCloseRequested&&"readable"===e._readableState}function tG(e){e._readableState="closed",e._readableCloseRequested=!0,e._readableController.close()}function tZ(e,t){"readable"===e._readableState&&(e._readableState="errored",e._readableStoredError=t),e._readableController.error(t)}function t0(e){return e._readableController.desiredSize}function t1(e,t){"writable"!==e._writableState?t3(e):t2(e,t)}function t2(e,t){e._writableState="erroring",e._writableStoredError=t,!e._writableHasInFlightOperation&&e._writableStarted&&t3(e)}function t3(e){e._writableState="errored"}function t8(e){"erroring"===e._writableState&&t3(e)}Object.defineProperties(tU.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),i(tU.prototype.enqueue,"enqueue"),i(tU.prototype.error,"error"),i(tU.prototype.terminate,"terminate"),"symbol"==typeof n.toStringTag&&Object.defineProperty(tU.prototype,n.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});var t6,t5,t4,t7=r(8692);async function*t9(e){let t=e.byteOffset+e.byteLength,r=e.byteOffset;for(;r!==t;){let n=Math.min(t-r,65536),o=e.buffer.slice(r,r+n);r+=o.byteLength,yield new Uint8Array(o)}}async function*re(e){let t=0;for(;t!==e.size;){let r=e.slice(t,Math.min(e.size,t+65536)),n=await r.arrayBuffer();t+=n.byteLength,yield new Uint8Array(n)}}async function*rt(e,t=!1){for(let r of e)ArrayBuffer.isView(r)?t?yield*t9(r):yield r:(0,t7.m)(r.stream)?yield*r.stream():yield*re(r)}/*! Based on fetch-blob. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> & David Frank */var rr=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},rn=function(e,t,r,n,o){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!o)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r};class ro{constructor(e=[],t={}){if(t6.set(this,[]),t5.set(this,""),t4.set(this,0),null!=t||(t={}),"object"!=typeof e||null===e)throw TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(!(0,t7.m)(e[Symbol.iterator]))throw TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if("object"!=typeof t&&!(0,t7.m)(t))throw TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");let r=new TextEncoder;for(let t of e){let e;e=ArrayBuffer.isView(t)?new Uint8Array(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)):t instanceof ArrayBuffer?new Uint8Array(t.slice(0)):t instanceof ro?t:r.encode(String(t)),rn(this,t4,rr(this,t4,"f")+(ArrayBuffer.isView(e)?e.byteLength:e.size),"f"),rr(this,t6,"f").push(e)}let n=void 0===t.type?"":String(t.type);rn(this,t5,/^[\x20-\x7E]*$/.test(n)?n:"","f")}static[(t6=new WeakMap,t5=new WeakMap,t4=new WeakMap,Symbol.hasInstance)](e){return!!(e&&"object"==typeof e&&(0,t7.m)(e.constructor)&&((0,t7.m)(e.stream)||(0,t7.m)(e.arrayBuffer))&&/^(Blob|File)$/.test(e[Symbol.toStringTag]))}get type(){return rr(this,t5,"f")}get size(){return rr(this,t4,"f")}slice(e,t,r){return new ro(function*(e,t,r=0,n){null!=n||(n=t);let o=r<0?Math.max(t+r,0):Math.min(r,t),s=n<0?Math.max(t+n,0):Math.min(n,t),i=Math.max(s-o,0),a=0;for(let t of e){if(a>=i)break;let e=ArrayBuffer.isView(t)?t.byteLength:t.size;if(o&&e<=o)o-=e,s-=e;else{let r;ArrayBuffer.isView(t)?a+=(r=t.subarray(o,Math.min(e,s))).byteLength:a+=(r=t.slice(o,Math.min(e,s))).size,s-=e,o=0,yield r}}}(rr(this,t6,"f"),this.size,e,t),{type:r})}async text(){let e=new TextDecoder,t="";for await(let r of rt(rr(this,t6,"f")))t+=e.decode(r,{stream:!0});return t+e.decode()}async arrayBuffer(){let e=new Uint8Array(this.size),t=0;for await(let r of rt(rr(this,t6,"f")))e.set(r,t),t+=r.length;return e.buffer}stream(){let e=rt(rr(this,t6,"f"),!0);return new tT({async pull(t){let{value:r,done:n}=await e.next();if(n)return queueMicrotask(()=>t.close());t.enqueue(r)},async cancel(){await e.return()}})}get[Symbol.toStringTag](){return"Blob"}}Object.defineProperties(ro.prototype,{type:{enumerable:!0},size:{enumerable:!0},slice:{enumerable:!0},stream:{enumerable:!0},text:{enumerable:!0},arrayBuffer:{enumerable:!0}})},2169:(e,t,r)=>{r.d(t,{$:()=>l});var n,o,s=r(4512),i=function(e,t,r,n,o){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!o)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r},a=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class l extends s.t{constructor(e,t,r={}){if(super(e,r),n.set(this,void 0),o.set(this,0),arguments.length<2)throw TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);i(this,n,String(t),"f");let s=void 0===r.lastModified?Date.now():Number(r.lastModified);Number.isNaN(s)||i(this,o,s,"f")}static[(n=new WeakMap,o=new WeakMap,Symbol.hasInstance)](e){return e instanceof s.t&&"File"===e[Symbol.toStringTag]&&"string"==typeof e.name}get name(){return a(this,n,"f")}get lastModified(){return a(this,o,"f")}get webkitRelativePath(){return""}get[Symbol.toStringTag](){return"File"}}},5620:(e,t,r)=>{r.d(t,{z:()=>o});var n=r(2169);let o=e=>e instanceof n.$},8692:(e,t,r)=>{r.d(t,{m:()=>n});let n=e=>"function"==typeof e}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[225,421,206],()=>r(7920));module.exports=n})();